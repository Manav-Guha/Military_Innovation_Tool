<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Military Innovation Assessment Framework</title>

  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Use env+react so modern syntax is transpiled -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" data-presets="env,react"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js UMD (auto-registered) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    .big-tabs{display:flex;align-items:center;justify-content:center;gap:1rem;margin:1.5rem 0}
    .big-tab{padding:.9rem 1.75rem;border-radius:1rem;font-weight:600;border:1px solid;transition:all .2s}
    .big-tab-inactive{background:#f3f4f6;border-color:#d1d5db;color:#374151}
    .big-tab-inactive:hover{background:#e5e7eb}
    .big-tab-active{background:#fff;border-color:#2563eb;color:#1d4ed8;box-shadow:0 20px 25px -5px rgba(0,0,0,.1),0 8px 10px -6px rgba(0,0,0,.1)}
    .panel{background:#fff;border:1px solid #e5e7eb;border-radius:1rem}
    .panel-h{padding:.9rem 1.25rem;border-bottom:1px solid #e5e7eb;font-weight:600}
    .panel-b{padding:1.25rem}
    .hint{font-size:.85rem;color:#6b7280}
    .item-row{padding:.6rem 0;border-bottom:1px solid #eef2f7}
    .item-row:last-child{border-bottom:none}
    .badge{display:inline-block;padding:.125rem .5rem;border-radius:.375rem;font-size:.75rem;font-weight:600}
    .meter{height:.5rem;background:#e5e7eb;border-radius:.375rem;overflow:hidden}
    .meter-fill{height:100%;background:#2563eb}
    .flag-icon{display:inline-flex;width:16px;height:16px;align-items:center;justify-content:center;border-radius:2px;margin-left:.4rem}
    .flag-mild{background:#f59e0b;color:#111;border:1px solid #7c2d12} /* yellow with black ! */
    .flag-major{background:#ef4444;color:#111;border:1px solid #111}    /* red with black ! */
    .dim-title{display:flex;align-items:center;gap:.25rem}
    .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center}
    .modal{background:#fff;border-radius:12px;max-width:720px;width:94%;box-shadow:0 25px 50px -12px rgba(0,0,0,.25)}
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div id="root" class="max-w-7xl mx-auto p-6"></div>

  <script type="text/babel">
    const {useState,useMemo,useEffect,useRef} = React;

    // ===== Dimensions (C/I/D/G) =====
    const DIMS = [
      { key:"Cognitive",        abbr:"C", label:"Cognitive (C)",             def:"Doctrine, training, and mental models change to accommodate the novelty." },
      { key:"Irreversibility",  abbr:"I", label:"Irreversibility (I)",       def:"Prior doctrine ceases to be viable as decisive practice; no rational return." },
      { key:"Disruption",       abbr:"D", label:"Disruptive Capacity (D)",   def:"Adversaries are compelled to abandon or radically alter existing methods." },
      { key:"Generative",       abbr:"G", label:"Generative Capacity (G)",   def:"The change enables new capabilities or follow-on innovations." }
    ];
    const ORDER = DIMS.map(d=>d.key);

    // ===== Sub-indicator scaffold (0–4 uniform scale) =====
    const SUBS = {
      Cognitive: [
        {k:"c1", name:"Core Assumptions Challenged", hint:"Prospective: which assumptions break? Retrospective: records show assumptions seen as broken."},
        {k:"c2", name:"Doctrine / Professional Military Education (PME) Revision", hint:"Prospective: plan for Tactics, Techniques, and Procedures (TTPs)/modules. Retrospective: practice embedded (manuals, SOPs, curricula)."},
        {k:"c3", name:"Shift in Command Attention", hint:"Prospective: new variables monitored. Retrospective: orders/After-Action Reports (AARs) show new focus."},
        {k:"c4", name:"New Criteria for Success", hint:"Prospective: requires new criteria. Retrospective: success defined and measured differently."}
      ],
      Irreversibility: [
        {k:"i1", name:"Training and Skill Path Dependence", hint:"New long-term pipelines vs none."},
        {k:"i2", name:"Logistics and Infrastructure Path Dependence", hint:"Supply, maintenance, infrastructure reconfigured."},
        {k:"i3", name:"Adversary Compulsion to Mirror", hint:"Extent of rival adoption."},
        {k:"i4", name:"Force Structure Changes", hint:"Units/Tables of Organization and Equipment (TO&E) created or reconfigured."}
      ],
      Disruption: [
        {k:"d1", name:"Enemy Observe–Orient–Decide–Act (OODA) Disruption", hint:"OODA cycle broken?"},
        {k:"d2", name:"Doctrinal Breakpoints", hint:"Old doctrine rendered unusable?"},
        {k:"d3", name:"Kill-Chain / Topology Shifts", hint:"Sequencing/roles fundamentally change?"},
        {k:"d4", name:"Adversary Scramble", hint:"Urgent, costly countermeasures?"}
      ],
      Generative: [
        {k:"g1", name:"New Capability Families", hint:"Follow-on families and branches?"},
        {k:"g2", name:"Cross-Domain Spillovers", hint:"Visible transfer across domains?"},
        {k:"g3", name:"Organizational Implications", hint:"New formations, schools, procurement categories?"},
        {k:"g4", name:"Conceptual Platform", hint:"Becomes base for further innovations?"}
      ]
    };

    // ===== Scoring helpers =====
    const meanToInt = arr => Math.round(arr.reduce((a,v)=>a+v,0)/arr.length);
    const thresholdOK = s => (s.Cognitive||0) >= 2 && (s.Irreversibility||0) >= 2;
    const indexScore = s => Math.round(25 * ORDER.reduce((a,k)=> a + (+s[k]||0), 0) / 4);
    function classify(s){
      const vals = ORDER.map(k => +s[k]||0);
      if (!thresholdOK(s)) return vals.some(v=>v>=2) ? "Modernization" : "Upgradation";
      const strong = vals.filter(v=>v>=3).length;
      if (strong >= 3) return "Transformational Innovation";
      if (strong >= 2) return "Innovation";
      return "Modernization";
    }

    // ===== Rule-driven contradictions =====
    const CONTRADICTION_RULES = [
      {
        id:"C_vs_I",
        conditions:[{dim:"Cognitive",min:3},{dim:"Irreversibility",max:1}],
        severity:"major",
        message:"High cognitive reframing with low irreversibility is inconsistent. Major doctrinal shifts typically embed in training, logistics, and structure."
      },
      {
        id:"C_vs_D",
        conditions:[{dim:"Cognitive",min:3},{dim:"Disruption",max:1}],
        severity:"mild",
        message:"Strong cognitive impact with minimal disruption is uncommon. If assumptions change, adversary patterns usually do as well."
      },
      {
        id:"D_vs_I",
        conditions:[{dim:"Disruption",min:3},{dim:"Irreversibility",max:1}],
        severity:"major",
        message:"High disruption rarely leaves institutions free to revert. Consider Irreversibility effects."
      },
      {
        id:"I_vs_G",
        conditions:[{dim:"Irreversibility",min:3},{dim:"Generative",max:1}],
        severity:"mild",
        message:"Lock-in without follow-on capability growth is atypical. Strong irreversibility tends to enable generative families."
      },
      {
        id:"G_vs_G3",
        conditions:[{dim:"Generative",min:3},{sub:"g3",max:1}],
        severity:"mild",
        message:"High generativity with minimal organizational implications is unlikely. Family-forming innovations alter units, procurement, or schools."
      },
      {
        id:"All_Max",
        conditions:[{dim:"Cognitive",min:4},{dim:"Irreversibility",min:4},{dim:"Disruption",min:4},{dim:"Generative",min:4}],
        severity:"major",
        message:"All four dimensions at maximum implies total systemic revolution. Extraordinary claims require extraordinary justification."
      },
      {
        id:"All_Min",
        conditions:[{dim:"Cognitive",max:0},{dim:"Irreversibility",max:0},{dim:"Disruption",max:0},{dim:"Generative",max:0}],
        severity:"mild",
        message:"All dimensions at zero indicates trivial change. Re-examine whether the case belongs in this framework."
      }
    ];

    function evaluateContradictions(dimScores, subScores) {
      const issues=[];
      for (var r=0;r<CONTRADICTION_RULES.length;r++){
        const rule = CONTRADICTION_RULES[r];
        var ok=true;
        for (var i=0;i<rule.conditions.length;i++){
          const c = rule.conditions[i];
          if (c.dim){
            const v = +dimScores[c.dim]||0;
            if (c.min!=null && v < c.min) { ok=false; break; }
            if (c.max!=null && v > c.max) { ok=false; break; }
          } else if (c.sub){
            const v2 = +subScores[c.sub]||0;
            if (c.min!=null && v2 < c.min) { ok=false; break; }
            if (c.max!=null && v2 > c.max) { ok=false; break; }
          }
        }
        if (ok) issues.push({id:rule.id,severity:rule.severity,message:rule.message});
      }
      const flags = { Cognitive:null, Irreversibility:null, Disruption:null, Generative:null };
      const bump = (curr,sev)=> {
        const rank = {mild:1,major:2};
        if(!curr) return sev;
        return rank[sev]>rank[curr]?sev:curr;
      };
      for (var j=0;j<issues.length;j++){
        const it = issues[j];
        if (it.id.indexOf("C_")>=0 || it.id.indexOf("_C")>=0) flags.Cognitive = bump(flags.Cognitive,it.severity);
        if (it.id.indexOf("I_")>=0 || it.id.indexOf("_I")>=0) flags.Irreversibility = bump(flags.Irreversibility,it.severity);
        if (it.id.indexOf("D_")>=0 || it.id.indexOf("_D")>=0) flags.Disruption = bump(flags.Disruption,it.severity);
        if (it.id.indexOf("G_")>=0 || it.id.indexOf("_G")>=0) flags.Generative = bump(flags.Generative,it.severity);
        if (it.id==="G_vs_G3") flags.Generative = bump(flags.Generative,it.severity);
      }
      return {issues, flags};
    }

    // ===== Examples (full library) =====
    const EXAMPLES = {
      "AI-Targeting": {
        scores: { Cognitive:1, Irreversibility:1, Disruption:1, Generative:2 },
        justification: "**Modernization**. AI-targeting speeds up existing processes but doesn't fundamentally change how war is fought.",
        sources: ["USAF Mad Scientist Initial Research"]
      },
      "AIP Submarine": {
        scores: { Cognitive:1, Irreversibility:2, Disruption:1, Generative:2 },
        justification: "AIP extends endurance and creates new patrol capabilities.",
        sources: ["Polmar & Moore, Cold War Submarines (2004)"]
      },
      "ASBM": {
        scores: { Cognitive:3, Irreversibility:2, Disruption:3, Generative:2 },
        justification: "Re-thinks carrier operations and power projection.",
        sources: ["Erickson, Chinese ASBM Development (2013)"]
      },
      "Barbed Wire": {
        scores: { Cognitive:3, Irreversibility:3, Disruption:3, Generative:2 },
        justification: "Offensive assumptions untenable; defensive thinking broadened.",
        sources: ["Bull, The Soldier's Kit (2013)"]
      },
      "Blitzkrieg": {
        scores: { Cognitive:4, Irreversibility:3, Disruption:4, Generative:4 },
        justification: "Transformed land warfare; spawned follow-ons; rethought strategy.",
        sources: ["Liddell Hart; Guderian"]
      },
      "Carrier Aviation": {
        scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 },
        justification: "Paradigm shift from battleships; naval aviation embedded.",
        sources: ["Friedman, U.S. Aircraft Carriers (1983)"]
      },
      "Cyber Warfare": {
        scores: { Cognitive:2, Irreversibility:2, Disruption:2, Generative:3 },
        justification: "Creates new operational domain alongside existing paradigms.",
        sources: ["Libicki, Conquest in Cyberspace (2012)"]
      },
      "Deep Battle/Reconnaissance Strike Complex": {
        scores: { Cognitive:4, Irreversibility:3, Disruption:4, Generative:3 },
        justification: "Frontal assaults untenable; operational art entrenched.",
        sources: ["Habeck, Storm of Steel (2003)"]
      },
      "F-16 Block D": {
        scores: { Cognitive:0, Irreversibility:1, Disruption:0, Generative:1 },
        justification: "Upgradation; performance within existing paradigm.",
        sources: ["USAF Fact Sheets"]
      },
      "Hypersonics": {
        scores: { Cognitive:1, Irreversibility:1, Disruption:1, Generative:2 },
        justification: "Accelerates missile paradigm; limited conceptual shift.",
        sources: ["Mahnken (2007)"]
      },
      "Information Warfare": {
        scores: { Cognitive:3, Irreversibility:3, Disruption:3, Generative:4 },
        justification: "Challenges C2 assumptions; influences politico-military boundaries.",
        sources: ["Ricks, The Generals (2012)"]
      },
      "Lasers": {
        scores: { Cognitive:1, Irreversibility:1, Disruption:2, Generative:2 },
        justification: "Operates within existing frameworks; limited embedding.",
        sources: ["AFRL Primer (2019)"]
      },
      "Machine Gun": {
        scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:3 },
        justification: "Linear tactics obsolete; irreversible organizational changes.",
        sources: ["Ellis, Social History of the Machine Gun (1975)"]
      },
      "Military Robotics": {
        scores: { Cognitive:1, Irreversibility:2, Disruption:1, Generative:3 },
        justification: "Extends human capability; limited reconceptualization.",
        sources: ["Singer, Wired for War (2009)"]
      },
      "Minie Ball/Conoidal Bullet": {
        scores: { Cognitive:3, Irreversibility:3, Disruption:3, Generative:2 },
        justification: "Napoleonic linear tactics untenable; assumptions questioned.",
        sources: ["Nosworthy (2003)"]
      },
      "Multi-Domain Battle Concept": {
        scores: { Cognitive:2, Irreversibility:1, Disruption:2, Generative:3 },
        justification: "Challenges stovepipes; embedding incomplete.",
        sources: ["TRADOC Pamphlet 525-3-1"]
      },
      "Network-Centric Warfare": {
        scores: { Cognitive:4, Irreversibility:2, Disruption:3, Generative:4 },
        justification: "Conceptual innovation preceded capability; path set.",
        sources: ["Alberts, Garstka, Stein (1999)"]
      },
      "Nuclear Weapons": {
        scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 },
        justification: "Complete transformation across dimensions.",
        sources: ["Freedman (2003)"]
      },
      "PGMs": {
        scores: { Cognitive:1, Irreversibility:2, Disruption:2, Generative:3 },
        justification: "Enhances paradigms; enables new targeting concepts.",
        sources: ["Hallion (1995)"]
      },
      "Radar": {
        scores: { Cognitive:2, Irreversibility:3, Disruption:3, Generative:3 },
        justification: "Transforms air defense; organization shifts.",
        sources: ["Fisher (1988)"]
      },
      "Stealth": {
        scores: { Cognitive:1, Irreversibility:2, Disruption:2, Generative:2 },
        justification: "Improves capabilities within established paradigms.",
        sources: ["Sweetman (1986)"]
      },
      "Stirrups": {
        scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 },
        justification: "Paradigmatic transformation; feudal structures emerge.",
        sources: ["Lynn White Jr. (1962)"]
      },
      "Stosstrupp Tactics": {
        scores: { Cognitive:4, Irreversibility:3, Disruption:4, Generative:3 },
        justification: "Linear assault untenable; infiltration logic embedded.",
        sources: ["Gudmundsson (1989)"]
      },
      "T-72B3M Main Battle Tank": {
        scores: { Cognitive:0, Irreversibility:1, Disruption:0, Generative:1 },
        justification: "Upgradation; better execution of established concepts.",
        sources: ["Bartles (2015)"]
      },
      "Tank": {
        scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 },
        justification: "Transformed land warfare; organizational change; new thinking.",
        sources: ["Harris (1995)"]
      },
      "Telegraph": {
        scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 },
        justification: "Courier assumptions untenable; networked command emerges.",
        sources: ["Hochfelder (2012)"]
      },
      "UAVs": {
        scores: { Cognitive:1, Irreversibility:2, Disruption:1, Generative:3 },
        justification: "Extends reconnaissance/strike; limited paradigm challenge.",
        sources: ["Singer (2009)"]
      }
    };

    // ===== Charts =====
    function RadarChart({scores}) {
      const ref = useRef(null);
      const chart = useRef(null);
      const values = useMemo(() => ORDER.map(k => +scores[k] || 0), [scores]);

      useEffect(() => {
        const ctx = ref.current.getContext('2d');
        if (chart.current) chart.current.destroy();
        chart.current = new Chart(ctx, {
          type: 'radar',
          data: {
            labels: DIMS.map(d => d.label),
            datasets: [
              {
                label: 'Current',
                data: values,
                fill: true,
                backgroundColor: 'rgba(37,99,235,0.2)',
                borderColor: 'rgba(37,99,235,1)',
                borderWidth: 2,
                pointRadius: 3
              },
              {
                label: 'Threshold (C≥2, I≥2)',
                data: [2,2,2,2],
                fill: false,
                borderColor: 'rgba(107,114,128,0.8)',
                borderDash: [6, 4],
                borderWidth: 1,
                pointRadius: 0
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'top' } },
            scales: {
              r: {
                beginAtZero: true,
                min: 0,
                max: 4,
                ticks: { stepSize: 1 }
              }
            }
          }
        });
        return () => { if (chart.current) chart.current.destroy(); };
      }, [values]);

      return <div style={{height:"400px"}}><canvas ref={ref}/></div>;
    }

    function BarChart({scores}){
      const ref=useRef(null), chart=useRef(null);
      const values = useMemo(()=> ORDER.map(k => +scores[k]||0), [scores]);
      const colorFor=v=> v>=3?'rgba(22,163,74,0.8)':v>=2?'rgba(234,179,8,0.9)':'rgba(239,68,68,0.9)';
      useEffect(()=>{
        const ctx=ref.current.getContext('2d');
        if(chart.current) chart.current.destroy();
        chart.current=new Chart(ctx,{
          type:'bar',
          data:{labels:DIMS.map(d=>d.label),
                datasets:[{label:'Dimension Scores',data:values,backgroundColor:values.map(colorFor)}]},
          options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},
                   scales:{y:{beginAtZero:true,min:0,max:4,ticks:{stepSize:1}}}}
        });
        return ()=> chart.current && chart.current.destroy();
      },[values]);
      return <div style={{height:"400px"}}><canvas ref={ref}/></div>;
    }

    function ChartsPanel({scores,meta,flags,openModal}){
      const flagChip=(sev)=> sev==='major'
        ? <span className="flag-icon flag-major" title="Major contradiction">!</span>
        : sev==='mild'
          ? <span className="flag-icon flag-mild" title="Mild mismatch">!</span>
          : null;
      return (
        <div className="grid md:grid-cols-2 gap-6">
          <div className="panel">
            <div className="panel-h">Radar</div>
            <div className="panel-b"><RadarChart scores={scores}/></div>
          </div>
          <div className="panel">
            <div className="panel-h">Bar (color-coded)</div>
            <div className="panel-b"><BarChart scores={scores}/></div>
          </div>
          <div className="md:col-span-2 panel panel-b text-sm">
            <div className="flex flex-wrap items-center gap-4">
              <div><span className="font-semibold">Index:</span> {indexScore(scores)}</div>
              <div><span className="font-semibold">Class:</span> {classify(scores)}</div>
              <div>{thresholdOK(scores)
                ? <span className="badge bg-green-100 text-green-800">Threshold met (C≥2 & I≥2)</span>
                : <span className="badge bg-yellow-100 text-yellow-800">Threshold not met</span>}</div>
              {meta && meta.label ? <div className="text-gray-600">Case: <span className="font-medium">{meta.label}</span></div> : null}
              <button onClick={openModal} className="ml-auto px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700">
                Review & Explain Flags
              </button>
            </div>
            <div className="mt-3 flex flex-wrap gap-4">
              {DIMS.map(d=>(
                <div key={d.key} className="text-sm">
                  <span className="font-medium">{d.label}</span>
                  {flagChip(flags[d.key])}
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    // ===== Sub panel =====
    function SubPanel({dim, values, setValue, locked=false}) {
      const items = SUBS[dim];
      const rated = items.filter(it => (values[it.k]||0) > 0).length;
      const agg = meanToInt(items.map(it => values[it.k]||0));
      const dMeta = DIMS.find(d=>d.key===dim);
      return (
        <div className="panel">
          <div className="panel-h">
            <div className="dim-title"><span>{dMeta.label}</span></div>
            <div className="hint">{dMeta.def}</div>
            <div className="text-sm text-gray-600 mt-1">{rated}/4 rated</div>
          </div>
          <div className="panel-b">
            {items.map(it=>(
              <div key={it.k} className="item-row">
                <div className="flex items-center justify-between">
                  <div className="font-medium text-sm">{it.name}</div>
                  <div className="text-xs text-gray-600">{values[it.k]||0}/4</div>
                </div>
                <div className="hint">{it.hint}</div>
                {locked ? (
                  <>
                    <div className="mt-2 meter"><div className="meter-fill" style={{width: `${((values[it.k]||0)/4)*100}%`}}></div></div>
                    <div className="text-[10px] text-gray-500 mt-1">Locked from historical case</div>
                  </>
                ) : (
                  <input type="range" min="0" max="4" value={values[it.k]||0}
                         onChange={e=> setValue(it.k, Number(e.target.value))}
                         className="w-full mt-2"/>
                )}
              </div>
            ))}
            <div className="mt-3 text-sm">
              <span className="font-medium">Derived {dim} score:</span> {agg}
            </div>
          </div>
        </div>
      );
    }

    // ===== Historical Examples =====
    function HistoricalExamples({setScores,setMeta,setFlags,setIssues}){
      const keys=Object.keys(EXAMPLES);
      const [sel,setSel]=useState("");
      const [subs,setSubs]=useState(null);

      function buildSubFromExample(ex) {
        const s = {};
        function rep(keys,val){ for (var i=0;i<keys.length;i++) s[keys[i]]=val; }
        rep(SUBS.Disruption.map(x=>x.k),      ex.scores.Disruption);
        rep(SUBS.Irreversibility.map(x=>x.k), ex.scores.Irreversibility);
        rep(SUBS.Cognitive.map(x=>x.k),       ex.scores.Cognitive);
        rep(SUBS.Generative.map(x=>x.k),      ex.scores.Generative);
        return s;
      }

      function aggregate(subVals){
        return {
          Disruption:      meanToInt([subVals.d1,subVals.d2,subVals.d3,subVals.d4]),
          Irreversibility: meanToInt([subVals.i1,subVals.i2,subVals.i3,subVals.i4]),
          Cognitive:       meanToInt([subVals.c1,subVals.c2,subVals.c3,subVals.c4]),
          Generative:      meanToInt([subVals.g1,subVals.g2,subVals.g3,subVals.g4]),
        };
      }

      function loadFromSelection(v){
        setSel(v);
        if (!v) return;
        const ex = EXAMPLES[v];
        setMeta({label: v, ex:ex});
        const subVals = buildSubFromExample(ex);
        setSubs(subVals);
        const dim = aggregate(subVals);
        setScores(dim);
        const {issues,flags} = evaluateContradictions(dim, subVals);
        setIssues(issues);
        setFlags(flags);
      }

      function setValue(k,v){
        setSubs(function(prev){
          const next = Object.assign({}, prev, { [k]: v });
          const dim = aggregate(next);
          setScores(dim);
          const res = evaluateContradictions(dim, next);
          setIssues(res.issues);
          setFlags(res.flags);
          return next;
        });
      }

      const ex = sel ? EXAMPLES[sel] : null;

      return (
        <div className="space-y-6">
          <div>
            <h2 className="text-2xl font-semibold">Historical Examples</h2>
            <p className="italic text-sm text-gray-600 mt-1">
              Select a case to auto-load its scores and charts. Adjusting any slider on a historical case triggers contradiction checks.
            </p>
          </div>

          <div className="flex flex-wrap items-center gap-3">
            <label className="text-sm font-medium">Example</label>
            <select value={sel} onChange={e=>loadFromSelection(e.target.value)} className="border rounded-md px-3 py-2 text-sm min-w-[18rem]">
              <option value="">— choose a case —</option>
              {keys.map(function(k){return <option key={k} value={k}>{k}</option>;})}
            </select>
          </div>

          {ex && (
            <div className="grid md:grid-cols-2 gap-6">
              {["Disruption","Irreversibility","Cognitive","Generative"].map(function(dim){
                const pick = {};
                const items = SUBS[dim];
                for (var i=0;i<items.length;i++){
                  const key = items[i].k;
                  pick[key] = subs && (key in subs) ? subs[key] : ex.scores[dim] || 0;
                }
                return <SubPanel key={dim} dim={dim} values={pick} setValue={setValue} locked={false} />;
              })}
              <div className="md:col-span-2 panel panel-b text-sm">
                <div className="font-semibold mb-1">Explanation & References</div>
                <div className="text-gray-700 mb-3">{ex.justification}</div>
                {(ex.sources||[]).map(function(r,i){return (<div key={i}>• {r}</div>);})}
              </div>
            </div>
          )}
        </div>
      );
    }

    // ===== Test Your Idea =====
    function TestYourIdea({setScores,setMeta,setFlags,setIssues}){
      const [label,setLabel]=useState("");
      const [sub,setSub]=useState({
        d1:0,d2:0,d3:0,d4:0,
        i1:0,i2:0,i3:0,i4:0,
        c1:0,c2:0,c3:0,c4:0,
        g1:0,g2:0,g3:0,g4:0
      });

      function aggregate(s){
        return {
          Disruption:      meanToInt([s.d1,s.d2,s.d3,s.d4]),
          Irreversibility: meanToInt([s.i1,s.i2,s.i3,s.i4]),
          Cognitive:       meanToInt([s.c1,s.c2,s.c3,s.c4]),
          Generative:      meanToInt([s.g1,s.g2,s.g3,s.g4]),
        };
      }

      function setValue(k,v){
        setSub(function(prev){
          const next = Object.assign({}, prev, { [k]: v });
          const dim = aggregate(next);
          setScores(dim);
          return next;
        });
      }

      useEffect(function(){ setMeta({label:label}); },[label]);

      function review(){
        const dim = aggregate(sub);
        const res = evaluateContradictions(dim, sub);
        setIssues(res.issues);
        setFlags(res.flags);
      }

      return (
        <div className="space-y-6">
          <div className="panel panel-b">
            <div className="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
              <div>
                <h2 className="text-2xl font-semibold">Test Your Idea</h2>
                <p className="italic text-sm text-gray-600">
                  Move the four sub-indicator sliders under each dimension. The tool averages them to derive C/I/D/G. Justify choices outside the tool.
                </p>
              </div>
              <div className="flex items-center gap-3">
                <label className="text-sm font-medium">Case title</label>
                <input value={label} onChange={e=>setLabel(e.target.value)}
                       className="border rounded-md px-3 py-2 text-sm w-72" placeholder="e.g., AI-enabled fires deconfliction"/>
              </div>
            </div>

            <div className="mt-5 grid md:grid-cols-2 gap-6">
              {["Disruption","Irreversibility","Cognitive","Generative"].map(function(dim){
                const pick = {};
                const items = SUBS[dim];
                for (var i=0;i<items.length;i++){
                  const key = items[i].k;
                  pick[key] = sub[key];
                }
                return <SubPanel key={dim} dim={dim} values={pick} setValue={setValue} locked={false} />;
              })}
            </div>

            <div className="mt-4 flex items-center gap-3">
              <button onClick={review} className="px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700">
                Review & Explain Flags
              </button>
              <span className="text-sm text-gray-600">Charts update live. Use Review to open the contradiction summary.</span>
            </div>
          </div>
        </div>
      );
    }

    // ===== Tabs, Legend, Modal =====
    function Tabs({tab,setTab}){
      const items=[
        {k:'examples',label:'Historical Examples'},
        {k:'charts',label:'Charts'},
        {k:'test',label:'Test Your Idea'}
      ];
      return (
        <div className="big-tabs">
          {items.map(function(t){
            return (
              <button key={t.k} onClick={()=>setTab(t.k)}
                className={'big-tab ' + (tab===t.k?'big-tab-active':'big-tab-inactive')}>{t.label}</button>
            );
          })}
        </div>
      );
    }

    function Legend(){
      return (
        <div className="panel panel-b text-sm">
          <div className="font-semibold mb-2">Scoring Legend</div>
          <ul className="list-disc list-inside text-gray-700 space-y-1">
            <li><b>0</b> = None</li>
            <li><b>1</b> = Minimal impact</li>
            <li><b>2</b> = Limited but measurable impact</li>
            <li><b>3</b> = Significant impact</li>
            <li><b>4</b> = Transformative impact</li>
          </ul>
        </div>
      );
    }

    function IssuesModal({issues,onClose}){
      if(!issues) return null;
      return (
        <div className="modal-bg" onClick={onClose}>
          <div className="modal" onClick={e=>e.stopPropagation()}>
            <div className="p-4 border-b">
              <div className="text-lg font-semibold">Possible Inconsistencies Detected</div>
              <div className="text-sm text-gray-600">Prompts to refine scoring, not errors.</div>
            </div>
            <div className="p-4 max-h-[60vh] overflow-auto">
              {issues.length===0 ? (
                <div className="text-sm text-gray-700">No contradictions detected.</div>
              ) : (
                <ul className="space-y-3">
                  {issues.map(function(it,i){
                    return (
                      <li key={i} className="flex items-start gap-2">
                        <span className={it.severity==='major'?'flag-icon flag-major':'flag-icon flag-mild'}>!</span>
                        <div className="text-sm text-gray-800">{it.message}</div>
                      </li>
                    );
                  })}
                </ul>
              )}
            </div>
            <div className="p-4 border-t text-right">
              <button onClick={onClose} className="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">OK</button>
            </div>
          </div>
        </div>
      );
    }

    // ===== App =====
    function App(){
      const [tab,setTab]=useState('examples');
      const [scores,setScores]=useState({Cognitive:0,Irreversibility:0,Disruption:0,Generative:0});
      const [meta,setMeta]=useState({label:""});
      const [flags,setFlags]=useState({ Cognitive:null, Irreversibility:null, Disruption:null, Generative:null });
      const [issues,setIssues]=useState([]);
      const [modalOpen,setModalOpen]=useState(false);

      const openModal = ()=> setModalOpen(true);
      const closeModal = ()=> setModalOpen(false);

      return (
        <main>
          <header className="text-center space-y-1 mb-4">
            <h1 className="text-4xl md:text-5xl font-extrabold text-gray-900">
              Military Innovation Assessment Framework
            </h1>
            <h2 className="text-xl md:text-2xl font-bold text-gray-800">
              A Four-Dimensional Recognition Tool
            </h2>
            <div className="italic text-md md:text-lg text-gray-700">
              Based on "Military Innovation: Between the Knowns and the Unknowns"
            </div>
            <div className="text-xs text-gray-500 mt-1">(c) Manabrata Guha, 2025</div>
          </header>

          <Tabs tab={tab} setTab={setTab}/>
          <Legend/>

          <section className="space-y-6">
            {tab==='examples' && (
              <>
                <HistoricalExamples
                  setScores={setScores}
                  setMeta={setMeta}
                  setFlags={setFlags}
                  setIssues={setIssues}
                />
                <ChartsPanel scores={scores} meta={meta} flags={flags} openModal={openModal}/>
              </>
            )}
            {tab==='charts' && (<ChartsPanel scores={scores} meta={meta} flags={flags} openModal={openModal}/>)}
            {tab==='test' && (<>
              <TestYourIdea setScores={setScores} setMeta={setMeta} setFlags={setFlags} setIssues={setIssues}/>
              <ChartsPanel scores={scores} meta={meta} flags={flags} openModal={openModal}/>
            </>)}
          </section>

          <footer className="mt-10 text-center text-xs text-gray-500">Single-file. Copy into your repo and open in a browser.</footer>

          {modalOpen && <IssuesModal issues={issues} onClose={closeModal}/>}
        </main>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
