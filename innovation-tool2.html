<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Military Innovation Assessment Framework</title>

  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" data-presets="env,react"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js UMD -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    .big-tabs{display:flex;align-items:center;justify-content:center;gap:1rem;margin:1.25rem 0;width:100%}
    .big-tab{padding:.9rem 1.75rem;border-radius:1rem;font-weight:700;border:1px solid;transition:all .2s;flex-shrink:0}
    .big-tab-inactive{background:#f3f4f6;border-color:#d1d5db;color:#374151}
    .big-tab-inactive:hover{background:#e5e7eb}
    .big-tab-active{background:#fff;border-color:#2563eb;color:#1d4ed8;box-shadow:0 20px 25px -5px rgba(0,0,0,.15),0 8px 10px -6px rgba(0,0,0,.12)}
    .panel{background:#fff;border:1px solid #e5e7eb;border-radius:1rem}
    .panel-h{padding:.9rem 1.25rem;border-bottom:1px solid #e5e7eb;font-weight:700}
    .panel-b{padding:1.1rem}
    .hint{font-size:.85rem;color:#6b7280}
    .item-row{padding:.7rem 0;border-bottom:1px solid #eef2f7}
    .item-row:last-child{border-bottom:none}
    .sub-item-row{padding:.5rem 0 .5rem 1rem;border-left:3px solid #e5e7eb;margin:.3rem 0}
    .badge{display:inline-block;padding:.125rem .5rem;border-radius:.375rem;font-size:.75rem;font-weight:700}
    .meter{height:.5rem;background:#e5e7eb;border-radius:.375rem;overflow:hidden}
    .meter-fill{height:100%;background:#2563eb}
    .flag-icon{display:inline-flex;width:16px;height:16px;align-items:center;justify-content:center;border-radius:2px;margin-left:.35rem;cursor:default}
    .flag-mild{background:#f59e0b;color:#111;border:1px solid #7c2d12}
    .flag-major{background:#ef4444;color:#111;border:1px solid #111}
    .tooltip{position:relative;display:inline-block}
    .tooltip .tip{visibility:hidden;opacity:0;transition:opacity .15s;position:absolute;z-index:20;top:130%;left:50%;transform:translateX(-50%);background:#111;color:#fff;border-radius:.4rem;font-size:.75rem;padding:.4rem .55rem;max-width:320px;white-space:normal}
    .tooltip:hover .tip{visibility:visible;opacity:1}
    .dim-title{display:flex;align-items:center;gap:.25rem}
    .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center}
    .modal{background:#fff;border-radius:12px;max-width:780px;width:94%;box-shadow:0 25px 50px -12px rgba(0,0,0,.25)}
    .modal-h{padding:1rem 1.1rem;border-bottom:1px solid #e5e7eb;font-weight:800}
    .modal-h.green{background:#ecfdf5;color:#065f46}
    .modal-h.yellow{background:#fffbeb;color:#78350f}
    .modal-h.red{background:#fee2e2;color:#7f1d1d}
    .modal-h.bg-blue-50{background:#eff6ff;color:#1e40af}
    .case-title-input{font-size:1.1rem;font-weight:600;padding:0.75rem 1rem;border:2px solid #3b82f6;border-radius:0.5rem;background:#f8fafc}
    .interaction-indicator{background:#e0f2fe;border:1px solid #0288d1;color:#01579b;padding:.125rem .375rem;border-radius:.25rem;font-size:.7rem;margin-left:.5rem}
    .theoretical-note{background:#f0f9ff;border:1px solid #0ea5e9;color:#0c4a6e;padding:.75rem 1rem;border-radius:.5rem;font-size:.8rem;line-height:1.4}
    .c2-composite{background:#f8fafc;border:1px solid #cbd5e1;border-radius:.5rem;padding:.75rem;margin:.5rem 0}
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div id="root" class="max-w-7xl mx-auto p-6"></div>

  <script type="text/babel">
    const {useState,useMemo,useEffect,useRef} = React;

    // ===== Qualitative Labels =====
    const LABELS = ["None", "Minimal", "Moderate", "Significant", "Transformative"];
    const getLabel = (value) => LABELS[Math.round(value)] || "None";
    const getValue = (label) => LABELS.indexOf(label);

    // ===== Dimensions (C/I/D/G) =====
    const DIMS = [
      { key:"Cognitive",        abbr:"C", label:"Cognitive (C)",             def:"Doctrine, training, and mental models change to accommodate the novelty." },
      { key:"Irreversibility",  abbr:"I", label:"Irreversibility (I)",       def:"Prior doctrine ceases to be viable as decisive practice; no rational return." },
      { key:"Disruption",       abbr:"D", label:"Disruptive Capacity (D)",   def:"Adversaries are compelled to abandon or radically alter existing methods." },
      { key:"Generative",       abbr:"G", label:"Generative Capacity (G)",   def:"The change enables new capabilities or follow-on innovations." }
    ];
    const ORDER = DIMS.map(d=>d.key);

    // ===== REVISED Sub-indicator scaffold =====
    const SUBS = {
      Cognitive: [
        {k:"c1", name:"Core Assumptions Challenged", hint:"Prospective: which fundamental assumptions might break? Retrospective: records show core assumptions seen as broken."},
        {k:"c2", name:"Shift in Process Logics/Systems", hint:"Composite measure of procedural, architectural, interface, and skill changes.", composite: true, 
         subElements: [
           {k:"c2a", name:"Procedural Integration", hint:"Does this require fundamentally new procedures or enhance existing ones? Enhancement = working within current SOPs; Transformation = new SOPs required."},
           {k:"c2b", name:"System Architecture", hint:"Does this require new infrastructure or integrate with existing systems? Integration = API connections; Transformation = ground-up reconstruction."},
           {k:"c2c", name:"Human-Machine Interface", hint:"Does this change how humans interact with systems? Enhancement = better displays; Transformation = new cognitive workflows."},
           {k:"c2d", name:"Skill Requirements", hint:"Does this require new professional competencies or upgrade existing ones? Enhancement = additional training; Transformation = new career fields."}
         ]},
        {k:"c3", name:"Doctrine / Professional Military Education (PME) Revision", hint:"Prospective: likely need for new Tactics, Techniques, and Procedures (TTPs)/modules. Retrospective: embedded in manuals, SOPs, curricula."},
        {k:"c4", name:"New Criteria for Success", hint:"Prospective: likely to require new criteria. Retrospective: success defined and measured differently."}
      ],
      Irreversibility: [
        {k:"i1", name:"Training and Skill Path Dependence", hint:"New long-term pipelines likely vs none."},
        {k:"i2", name:"Logistics and Infrastructure Path Dependence", hint:"Supply, maintenance, infrastructure likely to be reconfigured."},
        {k:"i3", name:"Adversary Compulsion to Mirror", hint:"Likely extent of rival adoption - essential for distinguishing innovation from experiment."},
        {k:"i4", name:"Institutional Lock-in Effects/Force Structure Changes", hint:"Organizational restructuring and sunk costs making reversal institutionally costly."}
      ],
      Disruption: [
        {k:"d1", name:"Enemy Observe—Orient—Decide—Act (OODA) Disruption", hint:"OODA cycle likely to be broken?"},
        {k:"d2", name:"Doctrinal Breakpoints", hint:"Old doctrine likely to be rendered unusable?"},
        {k:"d3", name:"Kill-Chain / Topology Shifts", hint:"Sequencing/roles likely to fundamentally change?"},
        {k:"d4", name:"Adversary Scramble", hint:"Urgent, costly countermeasures likely?"}
      ],
      Generative: [
        {k:"g1", name:"New Capability Families", hint:"Follow-on families and branches likely?"},
        {k:"g2", name:"Cross-Domain Spillovers", hint:"Visible transfer across domains likely?"},
        {k:"g3", name:"Organizational Implications", hint:"New formations, schools, procurement categories likely?"},
        {k:"g4", name:"Conceptual Platform", hint:"Likely to become base for further innovations?"}
      ]
    };
    
    const SUB_KEYS = {
      Cognitive: ["c1", "c2", "c3", "c4"],
      Irreversibility: ["i1", "i2", "i3", "i4"],
      Disruption: ["d1", "d2", "d3", "d4"],
      Generative: ["g1", "g2", "g3", "g4"]
    };

    // ===== Aggregation with Contextual Interactive Effects =====
    const meanToInt = arr => Math.round(arr.reduce((a,v)=>a+v,0)/arr.length);
    
    function aggregateC2(c2Scores) {
      // For C2 composite, average the 4 sub-elements
      return meanToInt([c2Scores.c2a||0, c2Scores.c2b||0, c2Scores.c2c||0, c2Scores.c2d||0]);
    }
    
    function aggregateWithContextualEffects(subVals) {
      const base = {
        Disruption:      meanToInt([subVals.d1,subVals.d2,subVals.d3,subVals.d4]),
        Irreversibility: meanToInt([subVals.i1,subVals.i2,subVals.i3,subVals.i4]),
        Cognitive:       meanToInt([subVals.c1,aggregateC2(subVals),subVals.c3,subVals.c4]),
        Generative:      meanToInt([subVals.g1,subVals.g2,subVals.g3,subVals.g4]),
      };
      
      // Check if primary threshold is met
      const meetsPrimaryThreshold = base.Cognitive >= 3 && base.Irreversibility >= 3;
      
      let interactions = {
        disruptiveBoost: 0,
        contextualElevation: 0
      };
      
      if (meetsPrimaryThreshold) {
        // Above primary threshold: only D-G synergy applies
        interactions.disruptiveBoost = (base.Disruption >= 2 && base.Generative >= 2) ?
          Math.min(0.3, (base.Disruption + base.Generative - 4) * 0.1) : 0;
      } else {
        // Below primary threshold: contextual framework may reveal innovation
        const dgSynergy = (base.Disruption >= 2 && base.Generative >= 2) ?
          Math.min(0.5, (base.Disruption + base.Generative - 4) * 0.15) : 0;
        
        // Apply contextual elevation if close to threshold with strong D-G
        if (dgSynergy > 0 && (base.Cognitive >= 2.5 || base.Irreversibility >= 2.5)) {
          interactions.contextualElevation = dgSynergy * 0.6;
        }
        
        interactions.disruptiveBoost = dgSynergy;
      }
      
      // Apply enhancements while maintaining bounds
      const enhanced = {
        Cognitive: Math.min(4, base.Cognitive + interactions.contextualElevation),
        Irreversibility: Math.min(4, base.Irreversibility + interactions.contextualElevation),
        Disruption: Math.min(4, base.Disruption + interactions.disruptiveBoost),
        Generative: Math.min(4, base.Generative + interactions.disruptiveBoost)
      };
      
      // Store metadata
      enhanced._interactions = interactions;
      enhanced._hasInteractions = Object.values(interactions).some(v => v > 0);
      enhanced._meetsPrimaryThreshold = meetsPrimaryThreshold;
      enhanced._contextuallyRevealed = !meetsPrimaryThreshold && enhanced.Cognitive >= 3 && enhanced.Irreversibility >= 3;
      enhanced._isHistoricalExample = false;
      
      return enhanced;
    }

    // ===== FIXED Classification Logic =====
    const indexScore = s => Math.round(25 * ORDER.reduce((a,k)=> a + (+s[k]||0), 0) / 4);
    
    function classify(dimScores, isHistoricalExample = false) {
      const vals = ORDER.map(k => +(dimScores[k]||0));
      
      if (isHistoricalExample) {
        // For historical examples, use direct dimensional scores
        const cognitiveScore = dimScores.Cognitive || 0;
        const irreversibilityScore = dimScores.Irreversibility || 0;
        
        if (cognitiveScore >= 3 && irreversibilityScore >= 3) {
          const strong = vals.filter(v => v >= 3).length;
          if (strong === 4) return "Transformative Innovation";
          if (strong >= 3) return "Revolutionary Innovation";
          return "Innovation";
        } else {
          return vals.some(v => v >= 2) ? "Modernization" : "Upgradation";
        }
      } else {
        // For user inputs, check both primary threshold and contextual framework
        const enhancedMeets = (dimScores.Cognitive||0) >= 3 && (dimScores.Irreversibility||0) >= 3;
        
        if (enhancedMeets) {
          if (dimScores._meetsPrimaryThreshold) {
            // Primary threshold recognition - classify by strength
            const strong = vals.filter(v=>v>=3).length;
            if (strong === 4) return "Transformative Innovation";
            if (strong >= 3) return "Revolutionary Innovation";
            return "Innovation";
          } else {
            // Contextual framework recognition
            return "Contextual Innovation";
          }
        } else {
          // Below recognition criteria
          return vals.some(v=>v>=2) ? "Modernization" : "Upgradation";
        }
      }
    }

    // ===== Complete Historical Examples =====
    const EXAMPLES = {
      "AI-Targeting": { scores: { Cognitive:1, Irreversibility:1, Disruption:1, Generative:2 }, justification: "AI-targeting speeds up existing processes; limited conceptual change.", sources: ["USAF Mad Scientist Initial Research"] },
      "AIP Submarine": { scores: { Cognitive:1, Irreversibility:2, Disruption:1, Generative:2 }, justification: "Extended endurance; new patrol patterns.", sources: ["Polmar & Moore, 2004"] },
      "ASBM": { scores: { Cognitive:3, Irreversibility:3, Disruption:3, Generative:2 }, justification: "Conceptual innovation that fundamentally altered naval operational art in the Pacific through creative integration of existing technologies (OTH radar, SAR satellites, MRBMs, MIRV warheads).", sources: ["Erickson, 2013"] },
      "Barbed Wire": { scores: { Cognitive:3, Irreversibility:3, Disruption:3, Generative:2 }, justification: "Offensive assumptions untenable; defensive shift.", sources: ["Bull, 2013"] },
      "Blitzkrieg": { scores: { Cognitive:4, Irreversibility:3, Disruption:4, Generative:4 }, justification: "Transformed land warfare; follow-ons; new strategy.", sources: ["Liddell Hart; Guderian"] },
      "Carrier Aviation": { scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 }, justification: "Shift from battleships; aviation embedded.", sources: ["Friedman, 1983"] },
      "Cyber Warfare": { scores: { Cognitive:2, Irreversibility:2, Disruption:2, Generative:3 }, justification: "New domain operating alongside existing paradigms.", sources: ["Libicki, 2012"] },
      "Deep Battle/Reconnaissance Strike Complex": { scores: { Cognitive:4, Irreversibility:3, Disruption:4, Generative:3 }, justification: "Frontal assaults untenable; operational art entrenched.", sources: ["Habeck, 2003"] },
      "F-16 Block D": { scores: { Cognitive:0, Irreversibility:1, Disruption:0, Generative:1 }, justification: "Modernization within existing air superiority paradigm. Enhanced capabilities trigger competitive procurement but no doctrinal transformation.", sources: ["USAF Fact Sheets"] },
      "Hypersonics": { scores: { Cognitive:1, Irreversibility:1, Disruption:1, Generative:2 }, justification: "Accelerates missiles; limited conceptual shift.", sources: ["Mahnken, 2007"] },
      "Information Warfare": { scores: { Cognitive:3, Irreversibility:3, Disruption:3, Generative:4 }, justification: "Digital-age transformation of ancient concept - epistemic innovation through digital-informatic mediation.", sources: ["Ricks, 2012"] },
      "Lasers": { scores: { Cognitive:1, Irreversibility:1, Disruption:2, Generative:2 }, justification: "Within existing frameworks; limited embedding.", sources: ["AFRL Primer, 2019"] },
      "Machine Gun": { scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:3 }, justification: "Linear tactics obsolete; irreversible organization.", sources: ["Ellis, 1975"] },
      "Military Robotics": { scores: { Cognitive:1, Irreversibility:2, Disruption:1, Generative:3 }, justification: "Extends human capability; limited reconceptualization.", sources: ["Singer, 2009"] },
      "Minie Ball/Conoidal Bullet": { scores: { Cognitive:3, Irreversibility:3, Disruption:3, Generative:2 }, justification: "Napoleonic tactics untenable; assumptions questioned.", sources: ["Nosworthy, 2003"] },
      "Multi-Domain Battle Concept": { scores: { Cognitive:2, Irreversibility:1, Disruption:2, Generative:3 }, justification: "Challenges stovepipes; embedding incomplete.", sources: ["TRADOC 525-3-1"] },
      "Network-Centric Warfare": { scores: { Cognitive:1, Irreversibility:0, Disruption:1, Generative:2 }, justification: "Theoretical concept without institutional acceptance or doctrinal embedding. What exists are System of Systems implementations rather than true NCW concepts.", sources: ["Alberts, Garstka, Stein, 1999"] },
      "Nuclear Weapons": { scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 }, justification: "Complete transformation.", sources: ["Freedman, 2003"] },
      "PGMs": { scores: { Cognitive:1, Irreversibility:2, Disruption:2, Generative:3 }, justification: "Enables new targeting; paradigm intact.", sources: ["Hallion, 1995"] },
      "Radar": { scores: { Cognitive:2, Irreversibility:3, Disruption:3, Generative:3 }, justification: "Transforms air defense; org shifts.", sources: ["Fisher, 1988"] },
      "Stealth": { scores: { Cognitive:1, Irreversibility:2, Disruption:2, Generative:2 }, justification: "Improves capabilities within paradigm.", sources: ["Sweetman, 1986"] },
      "Stirrups": { scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 }, justification: "Paradigmatic transformation; feudal structures - epistemic innovation through weaponized integration of human-terrain-speed relationships.", sources: ["Lynn White Jr., 1962"] },
      "Stosstrupp Tactics": { scores: { Cognitive:4, Irreversibility:3, Disruption:4, Generative:3 }, justification: "Linear assault untenable; infiltration embedded - epistemic innovation redefining human-terrain-speed relationships.", sources: ["Gudmundsson, 1989"] },
      "T-72B3M Main Battle Tank": { scores: { Cognitive:0, Irreversibility:1, Disruption:0, Generative:1 }, justification: "Upgradation.", sources: ["Bartles, 2015"] },
      "Tank": { scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 }, justification: "Transformed land warfare; org change; new thinking.", sources: ["Harris, 1995"] },
      "Telegraph": { scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 }, justification: "Courier assumptions untenable; networked command.", sources: ["Hochfelder, 2012"] },
      "UAVs": { scores: { Cognitive:1, Irreversibility:2, Disruption:1, Generative:3 }, justification: "Extends recon/strike; limited paradigm challenge.", sources: ["Singer, 2009"] }
    };

    // ===== Educational Analysis =====
    function getEducationalAnalysis(caseName, example) {
      const scores = example.scores;
      
      const insights = {
        "Network-Centric Warfare": [
          `**Corrected Assessment**: Scores C:${scores.Cognitive}, I:${scores.Irreversibility}, D:${scores.Disruption}, G:${scores.Generative} reflect lack of institutional acceptance and doctrinal embedding.`,
          `**Theoretical vs. Practical**: While NCW theory exists, military institutions remain platform-centric and cannot conceptualize network-centric approaches.`,
          `**Implementation Gap**: What exists in practice are System of Systems implementations rather than true Network-Centric Warfare concepts from CCRP literature.`,
          `**Recognition Framework Application**: Scores below C≥3, I≥3 threshold classify this as Upgradation rather than innovation, distinguishing failed experiments from successful transformations.`
        ],
        "Stirrups": [
          `**Transformative Innovation**: Maximum scores across all four dimensions (C:${scores.Cognitive}, I:${scores.Irreversibility}, D:${scores.Disruption}, G:${scores.Generative}) represent complete paradigmatic transformation.`,
          `**Epistemic Innovation**: Created feudal military structures through technological enablement of heavy cavalry tactics - weaponized integration of human-terrain-speed relationships.`,
          `**Strategic Revolution**: Fundamentally transformed medieval warfare organization and social structures.`
        ],
        "Information Warfare": [
          `**Revolutionary Innovation**: Scores C:${scores.Cognitive}, I:${scores.Irreversibility}, D:${scores.Disruption}, G:${scores.Generative} indicate significant paradigmatic transformation.`,
          `**Epistemic Innovation**: Digital-informatic mediation transforms the ontological nature of "information" itself, not just its weaponization.`,
          `**Conceptual Transformation**: From propaganda and deception to digital-epistemic warfare affecting knowledge structures themselves.`
        ],
        "F-16 Block D": [
          `**Platform vs Component Analysis**: Scores C:${scores.Cognitive}, I:${scores.Irreversibility}, D:${scores.Disruption}, G:${scores.Generative} reflect platform-level assessment rather than individual component innovations.`,
          `**Modernization Classification**: Enhanced capabilities within unchanged air superiority paradigms - no doctrinal transformation required.`,
          `**Competitive Procurement vs Strategic Disruption**: Adversary responses represent capability matching rather than paradigm adaptation.`,
          `**Framework Application**: Demonstrates distinction between technological sophistication and strategic innovation.`
        ],
        "ASBM": [
          `**Conceptual Innovation**: Scores C:${scores.Cognitive}, I:${scores.Irreversibility}, D:${scores.Disruption}, G:${scores.Generative} represent creative integration of existing technologies into new strategic concept.`,
          `**Naval Operational Art**: Fundamentally altered Pacific naval operations through anti-access/area-denial capabilities.`,
          `**System Integration**: Combined OTH radar, SAR satellites, MRBMs, and MIRV warheads into coherent anti-ship capability.`,
          `**Strategic Effect**: Forces fundamental reconsideration of carrier strike group operations and fleet composition.`
        ]
      };
      
      return insights[caseName] || [
        `**Historical Analysis**: This innovation scored C:${scores.Cognitive}, I:${scores.Irreversibility}, D:${scores.Disruption}, G:${scores.Generative} across the four dimensions.`,
        `**Classification**: ${classify(scores, true)} based on dimensional analysis and recognition criteria.`,
        `**Justification**: ${example.justification}`,
        `**Sources**: Based on analysis from ${example.sources.join(', ')}.`
      ];
    }

    // ===== Enhanced user feedback generation =====
    function generateUserFeedback(subScores, dimScores, classification) {
      const feedback = [];
      
      // Generate dimensional feedback
      ORDER.forEach(dim => {
        const dimData = DIMS.find(d => d.key === dim);
        const dimScore = dimScores[dim] || 0;
        
        if (dim === 'Cognitive') {
          feedback.push(`**${dimData.label}**: Core assumptions (${getLabel(subScores.c1||0).toLowerCase()}), Process shifts (${getLabel(aggregateC2(subScores)).toLowerCase()}), Doctrine revision (${getLabel(subScores.c3||0).toLowerCase()}), Success criteria (${getLabel(subScores.c4||0).toLowerCase()}). Total: ${getLabel(dimScore).toLowerCase()} (${Math.round(dimScore*10)/10}/4).`);
        } else {
          const subIndicators = SUBS[dim];
          const subDetails = subIndicators.map(sub => {
            const score = subScores[sub.k] || 0;
            return `${sub.name.replace(/Enemy |Adversary |New |Doctrinal /g, '').toLowerCase()}: ${getLabel(score).toLowerCase()}`;
          }).join(', ');
          
          feedback.push(`**${dimData.label}**: ${subDetails}. Total: ${getLabel(dimScore).toLowerCase()} (${Math.round(dimScore*10)/10}/4).`);
        }
      });
      
      // Add recognition criteria explanation
      if (dimScores._meetsPrimaryThreshold) {
        feedback.push(`**Primary Threshold Recognition**: Assessment meets the primary recognition criteria (C≥3, I≥3), revealing innovation through necessary manifestation patterns.`);
      } else if (dimScores._contextuallyRevealed) {
        feedback.push(`**Contextual Framework Recognition**: While base scores were below the primary threshold, strong Disruption-Generative interactions revealed innovation through contextual manifestation patterns.`);
      } else {
        feedback.push(`**Below Recognition Criteria**: Current assessment does not meet the primary threshold (C≥3, I≥3) or contextual framework requirements for innovation recognition.`);
      }
      
      // Add interaction effects explanation if present
      if (dimScores._hasInteractions) {
        feedback.push(`**Interactive Effects**: Assessment triggered contextual synergies between dimensions, reflecting the dynamic nature of military innovation manifestation.`);
      }
      
      // Add conclusion
      const total = ORDER.reduce((sum, dim) => sum + (dimScores[dim] || 0), 0);
      feedback.push(`**Final Classification**: Based on assessment patterns (total score: ${Math.round(total*10)/10}/16), this concept is classified as **${classification}**.`);
      
      return feedback;
    }

    // ===== Enhanced Modal =====
    function IssuesModal({issues,meta,subScores,dimScores,onClose}){
      if(!issues && !meta) return null;
      
      const isHistoricalExample = meta && meta.ex && EXAMPLES[meta.label];
      const isUserInput = !isHistoricalExample && meta && meta.label && Object.values(subScores || {}).some(v => v > 0);
      
      let cls='green', title='Assessment Review', sub='Assessment completed successfully.';
      let displayMessages = [];
      
      if (isUserInput) {
        cls = 'blue';
        title = 'Your Innovation Assessment';
        sub = `Analysis of your innovation concept: "${meta.label}"`;
        displayMessages = generateUserFeedback(subScores, dimScores, classify(dimScores, false));
      } else if (isHistoricalExample) {
        cls = 'blue';
        title = 'Historical Case Analysis';
        sub = `Educational analysis of ${meta.label}:`;
        displayMessages = getEducationalAnalysis(meta.label, meta.ex);
      } else {
        displayMessages = ["Assessment completed successfully."];
      }
      
      return (
        <div className="modal-bg" onClick={onClose}>
          <div className="modal" onClick={e=>e.stopPropagation()}>
            <div className={`modal-h ${cls === 'blue' ? 'bg-blue-50' : cls}`}>
              {title}
            </div>
            <div className="px-4 pt-2 pb-1 text-sm text-gray-700">{sub}</div>
            <div className="p-4 max-h-[60vh] overflow-auto">
              {displayMessages.length > 0 ? (
                <ul className="space-y-4">
                  {displayMessages.map((message,i)=>(
                    <li key={i} className="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
                      <span className="text-blue-600 font-bold text-lg">•</span>
                      <div className="text-sm text-gray-800 leading-relaxed" dangerouslySetInnerHTML={{__html: message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>')}}></div>
                    </li>
                  ))}
                </ul>
              ) : (
                <div className="text-sm text-gray-700">Assessment completed.</div>
              )}
              
              <div className="mt-6 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                <div className="font-semibold mb-1">Recognition Framework:</div>
                <div>The framework provides systematic criteria for recognizing innovation manifestation patterns. Innovation requires both conceptual transformation (C≥3) AND irreversible norm establishment (I≥3), with contextual framework recognition possible through strong Disruption-Generative interactions.</div>
              </div>
            </div>
            <div className="p-4 border-t text-right">
              <button onClick={onClose} className="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">OK</button>
            </div>
          </div>
        </div>
      );
    }

    // ===== Charts Panel with Chart.js Integration =====
    function ChartsPanel({scores, meta, openModal}) {
      const radarChartRef = useRef();
      const barChartRef = useRef();
      const dimensionChartRef = useRef();
      
      useEffect(() => {
        // Radar Chart
        if (radarChartRef.current) {
          const ctx = radarChartRef.current.getContext('2d');
          if (radarChartRef.current.chartInstance) {
            radarChartRef.current.chartInstance.destroy();
          }
          
          radarChartRef.current.chartInstance = new Chart(ctx, {
            type: 'radar',
            data: {
              labels: DIMS.map(d => d.abbr),
              datasets: [{
                label: 'Innovation Scores',
                data: DIMS.map(d => scores[d.key] || 0),
                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                borderColor: 'rgb(59, 130, 246)',
                borderWidth: 2,
                pointBackgroundColor: 'rgb(59, 130, 246)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgb(59, 130, 246)'
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                r: {
                  beginAtZero: true,
                  max: 4,
                  ticks: {
                    stepSize: 1
                  }
                }
              },
              plugins: {
                legend: {
                  display: false
                }
              }
            }
          });
        }

        // Bar Chart
        if (barChartRef.current) {
          const ctx = barChartRef.current.getContext('2d');
          if (barChartRef.current.chartInstance) {
            barChartRef.current.chartInstance.destroy();
          }
          
          barChartRef.current.chartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: DIMS.map(d => d.abbr),
              datasets: [{
                label: 'Scores',
                data: DIMS.map(d => scores[d.key] || 0),
                backgroundColor: [
                  'rgba(99, 102, 241, 0.8)',
                  'rgba(245, 158, 11, 0.8)',
                  'rgba(239, 68, 68, 0.8)',
                  'rgba(34, 197, 94, 0.8)'
                ],
                borderColor: [
                  'rgb(99, 102, 241)',
                  'rgb(245, 158, 11)',
                  'rgb(239, 68, 68)',
                  'rgb(34, 197, 94)'
                ],
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  max: 4,
                  ticks: {
                    stepSize: 1
                  }
                }
              },
              plugins: {
                legend: {
                  display: false
                }
              }
            }
          });
        }
        
        return () => {
          if (radarChartRef.current?.chartInstance) {
            radarChartRef.current.chartInstance.destroy();
          }
          if (barChartRef.current?.chartInstance) {
            barChartRef.current.chartInstance.destroy();
          }
          if (dimensionChartRef.current?.chartInstance) {
            dimensionChartRef.current.chartInstance.destroy();
          }
        };
      }, [scores]);

      const recognitionCriteria = useMemo(() => {
        const c = scores.Cognitive || 0;
        const i = scores.Irreversibility || 0;
        const d = scores.Disruption || 0;
        const g = scores.Generative || 0;
        
        const primaryThreshold = c >= 3 && i >= 3;
        const contextuallyRevealed = (d >= 2.5 && g >= 2.5 && (d + g) >= 6);
        const hasInteractions = (d * g) >= 6 || (c * i) >= 9;
        
        return { primaryThreshold, contextuallyRevealed, hasInteractions };
      }, [scores]);

      const classification = classify(scores, scores._isHistoricalExample);
      const avgScore = Object.values(scores).filter(v => typeof v === 'number').reduce((a, b) => a + b, 0) / 4;

      return (
        <div className="panel">
          <div className="panel-h">
            <div className="flex justify-between items-center">
              <span>Innovation Analysis Dashboard</span>
              <div className="flex gap-2">
                {recognitionCriteria.primaryThreshold ? (
                  <span className="badge bg-green-100 text-green-800">Primary Threshold Recognition (C≥3 & I≥3)</span>
                ) : recognitionCriteria.contextuallyRevealed ? (
                  <span className="badge bg-blue-100 text-blue-800">Contextual Framework Recognition</span>
                ) : (
                  <span className="badge bg-yellow-100 text-yellow-800">Below Recognition Criteria</span>
                )}
                {recognitionCriteria.hasInteractions && <div className="badge bg-purple-100 text-purple-800">Interactive Effects Active</div>}
                {meta && meta.label ? <div className="text-gray-600">Case: <span className="font-medium">{meta.label}</span></div> : null}
                <button onClick={openModal} className="ml-auto px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">
                  View Analysis
                </button>
              </div>
            </div>
            <div className="mt-3 grid grid-cols-2 md:grid-cols-4 gap-3">
              {DIMS.map(d=>(
                <div key={d.key} className="text-sm">
                  <span className="font-semibold">{d.label}:</span> {getLabel(scores[d.key] || 0)} ({Math.round((scores[d.key] || 0)*10)/10})
                </div>
              ))}
            </div>
          </div>
          <div className="panel-b">
            <div className="grid lg:grid-cols-2 gap-6">
              <div>
                <h4 className="text-lg font-semibold mb-3">Dimensional Radar</h4>
                <div style={{height: '300px'}}>
                  <canvas ref={radarChartRef}></canvas>
                </div>
              </div>
              <div>
                <h4 className="text-lg font-semibold mb-3">Comparative Analysis</h4>
                <div style={{height: '300px'}}>
                  <canvas ref={barChartRef}></canvas>
                </div>
              </div>
            </div>
            
            <div className="mt-6 p-4 bg-gray-50 rounded-lg">
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <div>
                  <div className="text-2xl font-bold text-blue-600">{classification}</div>
                  <div className="text-sm text-gray-600">Classification</div>
                </div>
                <div>
                  <div className="text-2xl font-bold text-green-600">{avgScore.toFixed(1)}/4.0</div>
                  <div className="text-sm text-gray-600">Overall Score</div>
                </div>
                <div>
                  <div className="text-2xl font-bold text-purple-600">{Math.round(indexScore(scores))}/100</div>
                  <div className="text-sm text-gray-600">Index Score</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ===== Test Your Idea Component =====
    function TestYourIdea({ setScores, setMeta, setSubScores, setIssues }) {
      const [subVals, setSubVals] = useState({});
      const [caseTitle, setCaseTitle] = useState('');
      
      const handleSubChange = (key, value) => {
        const newSubVals = { ...subVals, [key]: parseInt(value) || 0 };
        setSubVals(newSubVals);
        setSubScores(newSubVals);
        
        const enhanced = aggregateWithContextualEffects(newSubVals);
        setScores(enhanced);
        
        const meta = { label: caseTitle || 'Your Innovation' };
        setMeta(meta);
        setIssues(generateUserFeedback(newSubVals, enhanced, classify(enhanced, false)));
      };

      const handleCaseTitleChange = (e) => {
        setCaseTitle(e.target.value);
        const meta = { label: e.target.value || 'Your Innovation' };
        setMeta(meta);
      };

      return (
        <div className="panel">
          <div className="panel-h">Test Your Innovation Idea</div>
          <div className="panel-b">
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Innovation Case Name
              </label>
              <input
                type="text"
                value={caseTitle}
                onChange={handleCaseTitleChange}
                className="case-title-input w-full"
                placeholder="Enter your innovation concept name..."
              />
            </div>
            
            <div className="space-y-8">
              {DIMS.map(dim => (
                <div key={dim.key} className="border-l-4 pl-4" style={{ borderColor: dim.key === 'Cognitive' ? '#6366f1' : dim.key === 'Irreversibility' ? '#f59e0b' : dim.key === 'Disruption' ? '#ef4444' : '#22c55e' }}>
                  <div className="dim-title">
                    <h3 className="text-lg font-bold" style={{ color: dim.key === 'Cognitive' ? '#6366f1' : dim.key === 'Irreversibility' ? '#f59e0b' : dim.key === 'Disruption' ? '#ef4444' : '#22c55e' }}>
                      {dim.label}
                    </h3>
                    <div className="tooltip">
                      <span className="text-gray-400 cursor-help">ⓘ</span>
                      <div className="tip">{dim.def}</div>
                    </div>
                  </div>
                  
                  <div className="space-y-4 mt-4">
                    {SUBS[dim.key].map(sub => (
                      <div key={sub.k} className={sub.composite ? "c2-composite" : ""}>
                        <div className="flex justify-between items-start mb-2">
                          <div className="flex-1">
                            <label className="block text-sm font-medium text-gray-700">
                              {sub.name}
                              <div className="tooltip ml-1 inline-block">
                                <span className="text-gray-400 cursor-help text-xs">ⓘ</span>
                                <div className="tip">{sub.hint}</div>
                              </div>
                            </label>
                          </div>
                          <select
                            value={subVals[sub.k] || 0}
                            onChange={(e) => handleSubChange(sub.k, e.target.value)}
                            className="ml-3 px-3 py-1 border border-gray-300 rounded text-sm"
                          >
                            {LABELS.map((label, idx) => (
                              <option key={idx} value={idx}>{idx} - {label}</option>
                            ))}
                          </select>
                        </div>
                        
                        {sub.composite && sub.subElements && (
                          <div className="ml-4 space-y-2 border-l-2 border-gray-200 pl-3">
                            <div className="text-xs font-medium text-gray-600 mb-2">C2 Composite Sub-Elements:</div>
                            {sub.subElements.map(subEl => (
                              <div key={subEl.k} className="sub-item-row">
                                <div className="flex justify-between items-start">
                                  <div className="flex-1">
                                    <label className="block text-xs font-medium text-gray-600">
                                      {subEl.name}
                                      <div className="tooltip ml-1 inline-block">
                                        <span className="text-gray-400 cursor-help text-xs">ⓘ</span>
                                        <div className="tip">{subEl.hint}</div>
                                      </div>
                                    </label>
                                  </div>
                                  <select
                                    value={subVals[subEl.k] || 0}
                                    onChange={(e) => handleSubChange(subEl.k, e.target.value)}
                                    className="ml-3 px-2 py-1 border border-gray-300 rounded text-xs"
                                  >
                                    {LABELS.map((label, idx) => (
                                      <option key={idx} value={idx}>{idx} - {label}</option>
                                    ))}
                                  </select>
                                </div>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              ))}
            </div>
            
            <div className="mt-8 p-4 theoretical-note">
              <strong>Interactive Effects:</strong> High scores in related dimensions trigger synergistic bonuses - 
              Cognitive-Irreversibility reinforcement above C≥3 & I≥3, and Disruption-Generative synergy above D≥2 & G≥2. 
              The framework captures non-linear manifestation patterns in military innovation recognition.
            </div>
          </div>
        </div>
      );
    }

    // ===== Historical Examples Component =====
    function HistoricalExamples({ setScores, setMeta, setSubScores, setIssues }) {
      const [selectedExample, setSelectedExample] = useState('');

      const loadExample = (exampleName) => {
        if (!exampleName) {
          setScores({});
          setMeta({});
          setSubScores({});
          setIssues([]);
          return;
        }

        const example = EXAMPLES[exampleName];
        if (!example) return;

        const enhancedScores = { 
          ...example.scores, 
          _isHistoricalExample: true,
          _meetsPrimaryThreshold: (example.scores.Cognitive >= 3 && example.scores.Irreversibility >= 3)
        };
        
        setScores(enhancedScores);
        setMeta({ 
          label: exampleName, 
          ex: example,
          justification: example.justification,
          sources: example.sources
        });
        setSubScores({});
        setIssues(getEducationalAnalysis(exampleName, example));
      };

      return (
        <div className="panel">
          <div className="panel-h">Historical Military Innovation Examples</div>
          <div className="panel-b">
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Select Historical Case
              </label>
              <select
                value={selectedExample}
                onChange={(e) => {
                  setSelectedExample(e.target.value);
                  loadExample(e.target.value);
                }}
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option value="">Choose a historical example...</option>
                {Object.keys(EXAMPLES).sort().map(name => (
                  <option key={name} value={name}>{name}</option>
                ))}
              </select>
            </div>

            {selectedExample && EXAMPLES[selectedExample] && (
              <div className="bg-blue-50 p-4 rounded-lg mb-6">
                <h4 className="font-bold text-lg mb-2">{selectedExample}</h4>
                <p className="text-sm text-gray-700 mb-3">
                  <strong>Analysis:</strong> {EXAMPLES[selectedExample].justification}
                </p>
                <p className="text-xs text-gray-600">
                  <strong>Sources:</strong> {EXAMPLES[selectedExample].sources.join(', ')}
                </p>
                <div className="mt-3 grid grid-cols-4 gap-2">
                  {DIMS.map(d => (
                    <div key={d.key} className="text-center p-2 bg-white rounded">
                      <div className="text-lg font-bold" style={{ color: d.key === 'Cognitive' ? '#6366f1' : d.key === 'Irreversibility' ? '#f59e0b' : d.key === 'Disruption' ? '#ef4444' : '#22c55e' }}>
                        {EXAMPLES[selectedExample].scores[d.key]}
                      </div>
                      <div className="text-xs text-gray-600">{d.abbr}</div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
              {Object.entries(EXAMPLES).sort().map(([name, example]) => {
                const classification = classify(example.scores, true);
                const avgScore = Object.values(example.scores).reduce((a, b) => a + b, 0) / 4;
                
                return (
                  <button
                    key={name}
                    onClick={() => {
                      setSelectedExample(name);
                      loadExample(name);
                    }}
                    className={`p-3 rounded-lg border text-left transition-all ${
                      selectedExample === name 
                        ? 'border-blue-500 bg-blue-50' 
                        : 'border-gray-200 hover:border-gray-300 bg-white'
                    }`}
                  >
                    <div className="font-medium text-sm mb-1">{name}</div>
                    <div className="text-xs text-gray-600 mb-2">{classification}</div>
                    <div className="flex justify-between text-xs">
                      <span>Avg Score:</span>
                      <span className="font-medium">{avgScore.toFixed(1)}/4.0</span>
                    </div>
                  </button>
                );
              })}
            </div>
          </div>
        </div>
      );
    }

    // ===== Main App Component =====
    function App(){
      const [tab,setTab]=useState('test');
      const [scores,setScores]=useState({Cognitive:0,Irreversibility:0,Disruption:0,Generative:0});
      const [meta,setMeta]=useState({label:""});
      const [subScores,setSubScores]=useState({});
      const [issues,setIssues]=useState([]);
      const [modalOpen,setModalOpen]=useState(false);

      const openModal = ()=> setModalOpen(true);
      const closeModal = ()=> setModalOpen(false);

      return (
        <main>
          <header className="text-center space-y-1 mb-6">
            <h1 className="text-4xl md:text-5xl font-extrabold text-gray-900">
              Military Innovation Assessment Framework
            </h1>
            <h2 className="text-xl md:text-2xl font-bold text-gray-800">
              A Four-Dimensional Recognition Tool
            </h2>
            <div className="text-md md:text-lg text-gray-700">
              Based on "Military Innovation: Between the Knowns and the Unknowns"
            </div>
            <div className="text-xs text-gray-500 mt-1">(c) Manabrata Guha, 2025</div>
          </header>

          <div className="big-tabs">
            {[
              {k:'test',label:'Test Your Idea'},
              {k:'examples',label:'Historical Examples'}
            ].map(t=>(
              <button key={t.k} onClick={()=>setTab(t.k)}
                className={'big-tab ' + (tab===t.k?'big-tab-active':'big-tab-inactive')}>
                {t.label}
              </button>
            ))}
          </div>

          <div className="space-y-6">
            {tab==='test' && (
              <>
                <TestYourIdea
                  setScores={setScores}
                  setMeta={setMeta}
                  setSubScores={setSubScores}
                  setIssues={setIssues}
                />
                <ChartsPanel scores={scores} meta={meta} openModal={openModal}/>
              </>
            )}
            {tab==='examples' && (
              <>
                <HistoricalExamples
                  setScores={setScores}
                  setMeta={setMeta}
                  setSubScores={setSubScores}
                  setIssues={setIssues}
                />
                <ChartsPanel scores={scores} meta={meta} openModal={openModal}/>
              </>
            )}
          </div>

          <footer className="mt-10 text-center text-xs text-gray-500">
            Military Innovation Assessment Framework v3.1 - Recognition Framework Implementation
          </footer>

          {modalOpen && <IssuesModal issues={issues} meta={meta} subScores={subScores} dimScores={scores} onClose={closeModal}/>}
        </main>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
