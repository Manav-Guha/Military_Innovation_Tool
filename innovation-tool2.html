<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Military Innovation Assessment Framework</title>

  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" data-presets="env,react"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js UMD -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    .big-tabs{display:flex;align-items:center;justify-content:center;gap:1rem;margin:1.25rem 0;width:100%}
    .big-tab{padding:.9rem 1.75rem;border-radius:1rem;font-weight:700;border:1px solid;transition:all .2s;flex-shrink:0}
    .big-tab-inactive{background:#f3f4f6;border-color:#d1d5db;color:#374151}
    .big-tab-inactive:hover{background:#e5e7eb}
    .big-tab-active{background:#fff;border-color:#2563eb;color:#1d4ed8;box-shadow:0 20px 25px -5px rgba(0,0,0,.15),0 8px 10px -6px rgba(0,0,0,.12)}
    .panel{background:#fff;border:1px solid #e5e7eb;border-radius:1rem}
    .panel-h{padding:.9rem 1.25rem;border-bottom:1px solid #e5e7eb;font-weight:700}
    .panel-b{padding:1.1rem}
    .hint{font-size:.85rem;color:#6b7280}
    .item-row{padding:.7rem 0;border-bottom:1px solid #eef2f7}
    .item-row:last-child{border-bottom:none}
    .badge{display:inline-block;padding:.125rem .5rem;border-radius:.375rem;font-size:.75rem;font-weight:700}
    .meter{height:.5rem;background:#e5e7eb;border-radius:.375rem;overflow:hidden}
    .meter-fill{height:100%;background:#2563eb}
    .flag-icon{display:inline-flex;width:16px;height:16px;align-items:center;justify-content:center;border-radius:2px;margin-left:.35rem;cursor:default}
    .flag-mild{background:#f59e0b;color:#111;border:1px solid #7c2d12}
    .flag-major{background:#ef4444;color:#111;border:1px solid #111}
    .tooltip{position:relative;display:inline-block}
    .tooltip .tip{visibility:hidden;opacity:0;transition:opacity .15s;position:absolute;z-index:20;top:130%;left:50%;transform:translateX(-50%);background:#111;color:#fff;border-radius:.4rem;font-size:.75rem;padding:.4rem .55rem;max-width:320px;white-space:normal}
    .tooltip:hover .tip{visibility:visible;opacity:1}
    .dim-title{display:flex;align-items:center;gap:.25rem}
    .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center}
    .modal{background:#fff;border-radius:12px;max-width:780px;width:94%;box-shadow:0 25px 50px -12px rgba(0,0,0,.25)}
    .modal-h{padding:1rem 1.1rem;border-bottom:1px solid #e5e7eb;font-weight:800}
    .modal-h.green{background:#ecfdf5;color:#065f46}
    .modal-h.yellow{background:#fffbeb;color:#78350f}
    .modal-h.red{background:#fee2e2;color:#7f1d1d}
    .modal-h.bg-blue-50{background:#eff6ff;color:#1e40af}
    .case-title-input{font-size:1.1rem;font-weight:600;padding:0.75rem 1rem;border:2px solid #3b82f6;border-radius:0.5rem;background:#f8fafc}
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div id="root" class="max-w-7xl mx-auto p-6"></div>

  <script type="text/babel">
    const {useState,useMemo,useEffect,useRef} = React;

    // ===== Qualitative Labels =====
    const LABELS = ["None", "Minimal", "Moderate", "Significant", "Transformative"];
    const getLabel = (value) => LABELS[value] || "None";
    const getValue = (label) => LABELS.indexOf(label);

    // ===== Dimensions (C/I/D/G) =====
    const DIMS = [
      { key:"Cognitive",        abbr:"C", label:"Cognitive (C)",             def:"Doctrine, training, and mental models change to accommodate the novelty." },
      { key:"Irreversibility",  abbr:"I", label:"Irreversibility (I)",       def:"Prior doctrine ceases to be viable as decisive practice; no rational return." },
      { key:"Disruption",       abbr:"D", label:"Disruptive Capacity (D)",   def:"Adversaries are compelled to abandon or radically alter existing methods." },
      { key:"Generative",       abbr:"G", label:"Generative Capacity (G)",   def:"The change enables new capabilities or follow-on innovations." }
    ];
    const ORDER = DIMS.map(d=>d.key);

    // ===== Sub-indicator scaffold =====
    const SUBS = {
      Cognitive: [
        {k:"c1", name:"Core Assumptions Challenged", hint:"Prospective: which assumptions might break? Retrospective: records show assumptions seen as broken."},
        {k:"c2", name:"Doctrine / Professional Military Education (PME) Revision", hint:"Prospective: likely need for new Tactics, Techniques, and Procedures (TTPs)/modules. Retrospective: embedded in manuals, SOPs, curricula."},
        {k:"c3", name:"Shift in Command Attention", hint:"Prospective: new variables likely to be monitored. Retrospective: orders/After-Action Reports (AARs) show new focus."},
        {k:"c4", name:"New Criteria for Success", hint:"Prospective: likely to require new criteria. Retrospective: success defined and measured differently."}
      ],
      Irreversibility: [
        {k:"i1", name:"Training and Skill Path Dependence", hint:"New long-term pipelines likely vs none."},
        {k:"i2", name:"Logistics and Infrastructure Path Dependence", hint:"Supply, maintenance, infrastructure likely to be reconfigured."},
        {k:"i3", name:"Adversary Compulsion to Mirror", hint:"Likely extent of rival adoption."},
        {k:"i4", name:"Force Structure Changes", hint:"Units/Tables of Organization and Equipment (TO&E) likely to be created or reconfigured."}
      ],
      Disruption: [
        {k:"d1", name:"Enemy Observe–Orient–Decide–Act (OODA) Disruption", hint:"OODA cycle likely to be broken?"},
        {k:"d2", name:"Doctrinal Breakpoints", hint:"Old doctrine likely to be rendered unusable?"},
        {k:"d3", name:"Kill-Chain / Topology Shifts", hint:"Sequencing/roles likely to fundamentally change?"},
        {k:"d4", name:"Adversary Scramble", hint:"Urgent, costly countermeasures likely?"}
      ],
      Generative: [
        {k:"g1", name:"New Capability Families", hint:"Follow-on families and branches likely?"},
        {k:"g2", name:"Cross-Domain Spillovers", hint:"Visible transfer across domains likely?"},
        {k:"g3", name:"Organizational Implications", hint:"New formations, schools, procurement categories likely?"},
        {k:"g4", name:"Conceptual Platform", hint:"Likely to become base for further innovations?"}
      ]
    };
    const SUB_KEYS = {
      Cognitive: SUBS.Cognitive.map(x=>x.k),
      Irreversibility: SUBS.Irreversibility.map(x=>x.k),
      Disruption: SUBS.Disruption.map(x=>x.k),
      Generative: SUBS.Generative.map(x=>x.k)
    };

    // ===== Scoring helpers with updated thresholds =====
    const meanToInt = arr => Math.round(arr.reduce((a,v)=>a+v,0)/arr.length);
    const thresholdOK = s => (s.Cognitive||0) >= 3 && (s.Irreversibility||0) >= 3;
    const indexScore = s => Math.round(25 * ORDER.reduce((a,k)=> a + (+s[k]||0), 0) / 4);
    function classify(s){
      const vals = ORDER.map(k => +s[k]||0);
      if (!thresholdOK(s)) return vals.some(v=>v>=2) ? "Modernization" : "Upgradation";
      const strong = vals.filter(v=>v>=3).length;
      if (strong >= 3) return "Innovation";
      return "Modernization";
    }

    // ===== Updated Examples with ASBM rescoring =====
    const EXAMPLES = {
      "AI-Targeting": { scores: { Cognitive:1, Irreversibility:1, Disruption:1, Generative:2 }, justification: "AI-targeting speeds up existing processes; limited conceptual change.", sources: ["USAF Mad Scientist Initial Research"] },
      "AIP Submarine": { scores: { Cognitive:1, Irreversibility:2, Disruption:1, Generative:2 }, justification: "Extended endurance; new patrol patterns.", sources: ["Polmar & Moore, 2004"] },
      "ASBM": { scores: { Cognitive:3, Irreversibility:3, Disruption:3, Generative:2 }, justification: "Conceptual innovation that fundamentally altered naval operational art in the Pacific through creative integration of existing technologies (OTH radar, SAR satellites, MRBMs, MIRV warheads).", sources: ["Erickson, 2013"] },
      "Barbed Wire": { scores: { Cognitive:3, Irreversibility:3, Disruption:3, Generative:2 }, justification: "Offensive assumptions untenable; defensive shift.", sources: ["Bull, 2013"] },
      "Blitzkrieg": { scores: { Cognitive:4, Irreversibility:3, Disruption:4, Generative:4 }, justification: "Transformed land warfare; follow-ons; new strategy.", sources: ["Liddell Hart; Guderian"] },
      "Carrier Aviation": { scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 }, justification: "Shift from battleships; aviation embedded.", sources: ["Friedman, 1983"] },
      "Cyber Warfare": { scores: { Cognitive:2, Irreversibility:2, Disruption:2, Generative:3 }, justification: "New domain operating alongside existing paradigms.", sources: ["Libicki, 2012"] },
      "Deep Battle/Reconnaissance Strike Complex": { scores: { Cognitive:4, Irreversibility:3, Disruption:4, Generative:3 }, justification: "Frontal assaults untenable; operational art entrenched.", sources: ["Habeck, 2003"] },
      "F-16 Block D": { scores: { Cognitive:0, Irreversibility:1, Disruption:0, Generative:1 }, justification: "Upgradation within existing paradigm.", sources: ["USAF Fact Sheets"] },
      "Hypersonics": { scores: { Cognitive:1, Irreversibility:1, Disruption:1, Generative:2 }, justification: "Accelerates missiles; limited conceptual shift.", sources: ["Mahnken, 2007"] },
      "Information Warfare": { scores: { Cognitive:3, Irreversibility:3, Disruption:3, Generative:4 }, justification: "Challenges C2 assumptions; cross-boundary effects.", sources: ["Ricks, 2012"] },
      "Lasers": { scores: { Cognitive:1, Irreversibility:1, Disruption:2, Generative:2 }, justification: "Within existing frameworks; limited embedding.", sources: ["AFRL Primer, 2019"] },
      "Machine Gun": { scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:3 }, justification: "Linear tactics obsolete; irreversible organization.", sources: ["Ellis, 1975"] },
      "Military Robotics": { scores: { Cognitive:1, Irreversibility:2, Disruption:1, Generative:3 }, justification: "Extends human capability; limited reconceptualization.", sources: ["Singer, 2009"] },
      "Minie Ball/Conoidal Bullet": { scores: { Cognitive:3, Irreversibility:3, Disruption:3, Generative:2 }, justification: "Napoleonic tactics untenable; assumptions questioned.", sources: ["Nosworthy, 2003"] },
      "Multi-Domain Battle Concept": { scores: { Cognitive:2, Irreversibility:1, Disruption:2, Generative:3 }, justification: "Challenges stovepipes; embedding incomplete.", sources: ["TRADOC 525-3-1"] },
      "Network-Centric Warfare": { scores: { Cognitive:4, Irreversibility:2, Disruption:3, Generative:4 }, justification: "Concept preceded capability; path set.", sources: ["Alberts, Garstka, Stein, 1999"] },
      "Nuclear Weapons": { scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 }, justification: "Complete transformation.", sources: ["Freedman, 2003"] },
      "PGMs": { scores: { Cognitive:1, Irreversibility:2, Disruption:2, Generative:3 }, justification: "Enables new targeting; paradigm intact.", sources: ["Hallion, 1995"] },
      "Radar": { scores: { Cognitive:2, Irreversibility:3, Disruption:3, Generative:3 }, justification: "Transforms air defense; org shifts.", sources: ["Fisher, 1988"] },
      "Stealth": { scores: { Cognitive:1, Irreversibility:2, Disruption:2, Generative:2 }, justification: "Improves capabilities within paradigm.", sources: ["Sweetman, 1986"] },
      "Stirrups": { scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 }, justification: "Paradigmatic transformation; feudal structures.", sources: ["Lynn White Jr., 1962"] },
      "Stosstrupp Tactics": { scores: { Cognitive:4, Irreversibility:3, Disruption:4, Generative:3 }, justification: "Linear assault untenable; infiltration embedded.", sources: ["Gudmundsson, 1989"] },
      "T-72B3M Main Battle Tank": { scores: { Cognitive:0, Irreversibility:1, Disruption:0, Generative:1 }, justification: "Upgradation.", sources: ["Bartles, 2015"] },
      "Tank": { scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 }, justification: "Transformed land warfare; org change; new thinking.", sources: ["Harris, 1995"] },
      "Telegraph": { scores: { Cognitive:4, Irreversibility:4, Disruption:4, Generative:4 }, justification: "Courier assumptions untenable; networked command.", sources: ["Hochfelder, 2012"] },
      "UAVs": { scores: { Cognitive:1, Irreversibility:2, Disruption:1, Generative:3 }, justification: "Extends recon/strike; limited paradigm challenge.", sources: ["Singer, 2009"] }
    };

    // ===== Enhanced user feedback generation =====
    function generateUserFeedback(subScores, dimScores, classification) {
      const feedback = [];
      
      // Generate dimensional feedback
      ORDER.forEach(dim => {
        const dimData = DIMS.find(d => d.key === dim);
        const subIndicators = SUBS[dim];
        const dimScore = dimScores[dim] || 0;
        
        const subDetails = subIndicators.map(sub => {
          const score = subScores[sub.k] || 0;
          return `${sub.name.replace(/Enemy |Adversary |New |Doctrinal /g, '').toLowerCase()}: ${getLabel(score).toLowerCase()}`;
        }).join(', ');
        
        feedback.push(`**${dimData.label}**: You assessed ${subDetails}. This resulted in a cumulative ${getLabel(dimScore).toLowerCase()} level (${dimScore}/4) for the ${dim} dimension.`);
      });
      
      // Add conclusion
      const total = ORDER.reduce((sum, dim) => sum + (dimScores[dim] || 0), 0);
      feedback.push(`**Conclusion**: Based on your assessment across all four dimensions (total score: ${total}/16), your innovation concept is classified as **${classification}**.`);
      
      // Add threshold explanation
      if (!thresholdOK(dimScores)) {
        feedback.push(`*Note: Innovation classification requires both Cognitive ≥ Significant (3) and Irreversibility ≥ Significant (3). Your current scores are Cognitive: ${getLabel(dimScores.Cognitive || 0)} (${dimScores.Cognitive || 0}) and Irreversibility: ${getLabel(dimScores.Irreversibility || 0)} (${dimScores.Irreversibility || 0}).*`);
      }
      
      return feedback;
    }

    // ===== Enhanced Modal =====
    function IssuesModal({issues,meta,subScores,dimScores,onClose}){
      if(!issues) return null;
      
      const isHistoricalExample = meta && meta.ex && EXAMPLES[meta.label];
      const isUserInput = !isHistoricalExample && meta && meta.label && Object.values(subScores || {}).some(v => v > 0);
      
      let cls='green', title='Assessment Review', sub='Your scoring appears consistent across dimensions.';
      let displayMessages = [];
      
      if (isUserInput) {
        // Enhanced feedback for user inputs
        cls = 'blue';
        title = 'Your Innovation Assessment';
        sub = `Analysis of your innovation concept: "${meta.label}"`;
        displayMessages = generateUserFeedback(subScores, dimScores, classify(dimScores));
      } else if (isHistoricalExample) {
        // Educational analysis for historical examples
        cls = 'blue';
        title = 'Historical Case Analysis';
        sub = `Educational analysis of ${meta.label}:`;
        displayMessages = getEducationalAnalysis(meta.label, meta.ex);
      } else {
        // Standard contradiction analysis
        const majors = issues.filter(x=>x.severity==='major').length;
        const milds = issues.filter(x=>x.severity==='mild').length;
        if (majors || milds) {
          if (majors) {
            cls = 'red';
            title = 'Assessment Review - Issues Found';
            sub = `Found ${majors} major issue${majors>1?'s':''} and ${milds} minor issue${milds>1?'s':''}.`;
          } else {
            cls = 'yellow';
            title = 'Assessment Review - Minor Issues';
            sub = `Found ${milds} minor issue${milds>1?'s':''}.`;
          }
          displayMessages = issues.map(issue => issue.message);
        }
      }
      
      return (
        <div className="modal-bg" onClick={onClose}>
          <div className="modal" onClick={e=>e.stopPropagation()}>
            <div className={`modal-h ${cls === 'blue' ? 'bg-blue-50' : cls}`}>
              {title}
            </div>
            <div className="px-4 pt-2 pb-1 text-sm text-gray-700">{sub}</div>
            <div className="p-4 max-h-[60vh] overflow-auto">
              {displayMessages.length > 0 ? (
                <ul className="space-y-4">
                  {displayMessages.map((message,i)=>(
                    <li key={i} className="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
                      <span className="text-blue-600 font-bold text-lg">•</span>
                      <div className="text-sm text-gray-800 leading-relaxed" dangerouslySetInnerHTML={{__html: message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>')}}></div>
                    </li>
                  ))}
                </ul>
              ) : (
                <div className="text-sm text-gray-700">No issues detected. Your scoring appears well-balanced across the four dimensions.</div>
              )}
              
              <div className="mt-6 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                <div className="font-semibold mb-1">Methodological Note:</div>
                Numerical values (0-4) are used for computational purposes only. Assessment is based on qualitative evidence levels: None, Minimal, Moderate, Significant, Transformative.
              </div>
            </div>
            <div className="p-4 border-t text-right">
              <button onClick={onClose} className="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">OK</button>
            </div>
          </div>
        </div>
      );
    }

    // ===== Educational Analysis =====
    function getEducationalAnalysis(caseName, example) {
      const scores = example.scores;
      
      const insights = {
        "ASBM": [
          `**Conceptual Innovation Pattern**: High Cognitive (${scores.Cognitive}), Irreversibility (${scores.Irreversibility}), and Disruption (${scores.Disruption}) scores indicate significant paradigmatic impact.`,
          `**Key Insight**: ASBM represents conceptual innovation - the creative integration of existing technologies (OTH radar, SAR satellites, MRBMs, MIRV warheads) to create capabilities that fundamentally altered naval operational art.`,
          `**Significance**: Demonstrates how conceptual breakthroughs can achieve transformation through intellectual integration rather than technological advancement, showing that military advantage can emerge from thinking differently about available tools.`
        ],
        "Military Robotics": [
          `**Modernization Pattern**: Higher Generative (${scores.Generative}) score with lower Cognitive (${scores.Cognitive}) and Disruption (${scores.Disruption}) indicating capability extension without paradigmatic change.`,
          `**Key Insight**: Military robotics extends human capabilities and opens new operational possibilities without fundamentally changing military doctrine or strategic thinking.`,
          `**Significance**: Illustrates how advanced technology can create new capabilities while operating within established conceptual frameworks.`
        ],
        "Blitzkrieg": [
          `**Innovation Pattern**: Maximum or near-maximum scores across Cognitive (${scores.Cognitive}), Disruption (${scores.Disruption}), and Generative (${scores.Generative}) dimensions.`,
          `**Key Insight**: Blitzkrieg represents complete paradigmatic transformation - making attrition warfare assumptions untenable while spawning numerous follow-on operational innovations.`,
          `**Significance**: Exemplifies rare cases of total systemic military revolution that redefines warfare itself.`
        ]
      };
      
      return insights[caseName] || [
        `**Scoring Pattern**: This case shows scores of C:${scores.Cognitive}, I:${scores.Irreversibility}, D:${scores.Disruption}, G:${scores.Generative} across the four dimensions.`,
        `**Classification**: Represents an example of ${classify(scores)} in military development.`,
        `**Framework Application**: Demonstrates how the four-dimensional framework distinguishes between different types of military change.`
      ];
    }

    // ===== Sub Panel with Qualitative Labels =====
    function SubPanel({dim, values, setValue, locked=false}) {
      const items = SUBS[dim];
      const rated = items.filter(it => (values[it.k]||0) > 0).length;
      const agg = meanToInt(items.map(it => values[it.k]||0));
      const dMeta = DIMS.find(d=>d.key===dim);
      
      return (
        <div className="panel">
          <div className="panel-h">
            <div className="dim-title"><span>{dMeta.label}</span></div>
            <div className="hint">{dMeta.def}</div>
            <div className="text-sm text-gray-600 mt-1">{rated}/4 rated • Score: {getLabel(agg)} ({agg})</div>
          </div>
          <div className="panel-b">
            {items.map(it=>(
              <div key={it.k} className="item-row">
                <div className="flex items-center justify-between">
                  <div className="font-medium text-sm">
                    <span>{it.name}</span>
                  </div>
                  <div className="text-xs text-gray-600">{getLabel(values[it.k]||0)}</div>
                </div>
                <div className="hint">{it.hint}</div>
                {locked ? (
                  <>
                    <div className="mt-2 meter"><div className="meter-fill" style={{width: `${((values[it.k]||0)/4)*100}%`}}></div></div>
                    <div className="text-[10px] text-gray-500 mt-1">Locked from historical case</div>
                  </>
                ) : (
                  <div className="mt-3">
                    <input type="range" min="0" max="4" value={values[it.k]||0}
                      onChange={e=> setValue(it.k, Number(e.target.value))}
                      className="w-full"/>
                    <div className="flex justify-between text-xs text-gray-500 mt-1">
                      {LABELS.map((label, idx) => (
                        <span key={idx} className={values[it.k] === idx ? 'font-bold text-blue-600' : ''}>{label}</span>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      );
    }

    // ===== Charts =====
    function RadarChart({scores}) {
      const ref = useRef(null);
      const chart = useRef(null);
      const values = useMemo(() => ORDER.map(k => +scores[k] || 0), [scores]);

      useEffect(() => {
        const ctx = ref.current.getContext('2d');
        if (chart.current) chart.current.destroy();
        chart.current = new Chart(ctx, {
          type: 'radar',
          data: {
            labels: DIMS.map(d => d.label),
            datasets: [
              {
                label: 'Current',
                data: values,
                fill: true,
                backgroundColor: 'rgba(37,99,235,0.2)',
                borderColor: 'rgba(37,99,235,1)',
                borderWidth: 2,
                pointRadius: 3
              },
              {
                label: 'Innovation Threshold (C≥3, I≥3)',
                data: [3,3,3,3],
                fill: false,
                borderColor: 'rgba(107,114,128,0.8)',
                borderDash: [6, 4],
                borderWidth: 1,
                pointRadius: 0
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'top' } },
            scales: {
              r: {
                beginAtZero: true,
                min: 0,
                max: 4,
                ticks: { 
                  stepSize: 1,
                  callback: function(value) {
                    return getLabel(value);
                  }
                }
              }
            }
          }
        });
        return () => { if (chart.current) chart.current.destroy(); };
      }, [values]);

      return <div style={{height:"400px"}}><canvas ref={ref}/></div>;
    }

    function BarChart({scores}){
      const ref=useRef(null), chart=useRef(null);
      const values = useMemo(()=> ORDER.map(k => +scores[k]||0), [scores]);
      const colorFor=v=> v>=3?'rgba(22,163,74,0.85)':v>=2?'rgba(234,179,8,0.95)':'rgba(239,68,68,0.95)';
      
      useEffect(()=>{
        const ctx=ref.current.getContext('2d');
        if(chart.current) chart.current.destroy();
        chart.current=new Chart(ctx,{
          type:'bar',
          data:{
            labels:DIMS.map(d=>d.label),
            datasets:[{
              label:'Dimension Scores',
              data:values,
              backgroundColor:values.map(colorFor)
            }]
          },
          options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{legend:{display:false}},
            scales:{
              y:{
                beginAtZero:true,
                min:0,
                max:4,
                ticks:{
                  stepSize:1,
                  callback: function(value) {
                    return getLabel(value);
                  }
                }
              }
            }
          }
        });
        return ()=> chart.current && chart.current.destroy();
      },[values]);
      return <div style={{height:"400px"}}><canvas ref={ref}/></div>;
    }

    // ===== Historical Examples =====
    function HistoricalExamples({setScores,setMeta,setSubScores,setIssues}){
      const keys=Object.keys(EXAMPLES);
      const [sel,setSel]=useState("");
      const [subs,setSubs]=useState(null);

      function buildSubFromExample(ex) {
        const s = {};
        function rep(keys,val){ for (let i=0;i<keys.length;i++) s[keys[i]]=val; }
        rep(SUB_KEYS.Disruption,      ex.scores.Disruption);
        rep(SUB_KEYS.Irreversibility, ex.scores.Irreversibility);
        rep(SUB_KEYS.Cognitive,       ex.scores.Cognitive);
        rep(SUB_KEYS.Generative,      ex.scores.Generative);
        return s;
      }

      function aggregate(subVals){
        return {
          Disruption:      meanToInt([subVals.d1,subVals.d2,subVals.d3,subVals.d4]),
          Irreversibility: meanToInt([subVals.i1,subVals.i2,subVals.i3,subVals.i4]),
          Cognitive:       meanToInt([subVals.c1,subVals.c2,subVals.c3,subVals.c4]),
          Generative:      meanToInt([subVals.g1,subVals.g2,subVals.g3,subVals.g4]),
        };
      }

      function runEval(nextSubs){
        const dim = aggregate(nextSubs);
        setScores(dim);
        setSubScores(nextSubs);
        setIssues([]);
      }

      function loadFromSelection(v){
        setSel(v);
        if (!v) return;
        const ex = EXAMPLES[v];
        setMeta({label: v, ex:ex});
        const subVals = buildSubFromExample(ex);
        setSubs(subVals);
        runEval(subVals);
      }

      function setValue(k,v){
        setSubs(function(prev){
          const next = Object.assign({}, prev, { [k]: v });
          runEval(next);
          return next;
        });
      }

      const ex = sel ? EXAMPLES[sel] : null;

      return (
        <div className="space-y-6">
          <div>
            <h2 className="text-2xl font-semibold">Historical Examples</h2>
            <p className="text-sm text-gray-600 mt-1">
              Select a case to explore how different types of military changes manifest across the four dimensions.
            </p>
          </div>

          <div className="flex flex-wrap items-center gap-3">
            <label className="text-sm font-medium">Example</label>
            <select value={sel} onChange={e=>loadFromSelection(e.target.value)} className="border rounded-md px-3 py-2 text-sm min-w-[20rem]">
              <option value="">— choose a case —</option>
              {keys.map(k=><option key={k} value={k}>{k}</option>)}
            </select>
          </div>

          {ex && (
            <div className="grid md:grid-cols-2 gap-6">
              {["Disruption","Irreversibility","Cognitive","Generative"].map(dim=>{
                const pick = {};
                for (let i=0;i<SUB_KEYS[dim].length;i++){
                  const key = SUB_KEYS[dim][i];
                  pick[key] = subs && (key in subs) ? subs[key] : ex.scores[dim] || 0;
                }
                return <SubPanel key={dim} dim={dim} values={pick} setValue={setValue} locked={false} />;
              })}
              <div className="md:col-span-2 panel panel-b text-sm">
                <div className="font-semibold mb-1">Explanation & References</div>
                <div className="text-gray-700 mb-3">{ex.justification}</div>
                {(ex.sources||[]).map((r,i)=>(<div key={i}>• {r}</div>))}
              </div>
            </div>
          )}
        </div>
      );
    }

    // ===== Test Your Idea (enhanced) =====
    function TestYourIdea({setScores,setMeta,setSubScores,setIssues}){
      const [label,setLabel]=useState("");
      const [sub,setSub]=useState({
        d1:0,d2:0,d3:0,d4:0,
        i1:0,i2:0,i3:0,i4:0,
        c1:0,c2:0,c3:0,c4:0,
        g1:0,g2:0,g3:0,g4:0
      });

      function aggregate(s){
        return {
          Disruption:      meanToInt([s.d1,s.d2,s.d3,s.d4]),
          Irreversibility: meanToInt([s.i1,s.i2,s.i3,s.i4]),
          Cognitive:       meanToInt([s.c1,s.c2,s.c3,s.c4]),
          Generative:      meanToInt([s.g1,s.g2,s.g3,s.g4]),
        };
      }

      function runEval(nextSub){
        const dim = aggregate(nextSub);
        setScores(dim);
        setSubScores(nextSub);
        setIssues([]);
      }

      function setValue(k,v){
        setSub(function(prev){
          const next = Object.assign({}, prev, { [k]: v });
          runEval(next);
          return next;
        });
      }

      useEffect(()=>{ setMeta({label}); },[label]);

      return (
        <div className="space-y-6">
          <div className="panel panel-b">
            <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
              <div>
                <h2 className="text-2xl font-semibold">Test Your Idea</h2>
                <p className="text-sm text-gray-600 mt-2">
                  Assess your innovation concept across the four dimensions. Use the sliders to indicate the likely manifestation level for each sub-indicator. Justify your assessments with evidence outside this tool.
                </p>
              </div>
              <div className="flex flex-col gap-2">
                <label className="text-sm font-medium text-gray-700">Innovation Concept Title</label>
                <input value={label} onChange={e=>setLabel(e.target.value)}
                       className="case-title-input w-80" 
                       placeholder="e.g., AI-enabled autonomous logistics coordination"/>
                {!label && <div className="text-xs text-blue-600">Enter a descriptive title for your innovation concept</div>}
              </div>
            </div>

            <div className="mt-6 grid md:grid-cols-2 gap-6">
              {["Disruption","Irreversibility","Cognitive","Generative"].map(dim=>{
                const pick = {};
                for (let i=0;i<SUB_KEYS[dim].length;i++){
                  const key = SUB_KEYS[dim][i];
                  pick[key] = sub[key];
                }
                return <SubPanel key={dim} dim={dim} values={pick} setValue={setValue} locked={false} />;
              })}
            </div>
          </div>
        </div>
      );
    }

    // ===== Charts panel =====
    function ChartsPanel({scores,meta,openModal}){
      return (
        <div className="grid md:grid-cols-2 gap-6">
          <div className="panel">
            <div className="panel-h">Radar Chart</div>
            <div className="panel-b"><RadarChart scores={scores}/></div>
          </div>
          <div className="panel">
            <div className="panel-h">Bar Chart (Qualitative Scale)</div>
            <div className="panel-b"><BarChart scores={scores}/></div>
          </div>
          <div className="md:col-span-2 panel panel-b text-sm">
            <div className="flex flex-wrap items-center gap-4">
              <div><span className="font-semibold">Index:</span> {indexScore(scores)}</div>
              <div><span className="font-semibold">Class:</span> {classify(scores)}</div>
              <div>{thresholdOK(scores)
                ? <span className="badge bg-green-100 text-green-800">Innovation Threshold Met (C≥3 & I≥3)</span>
                : <span className="badge bg-yellow-100 text-yellow-800">Innovation Threshold Not Met</span>}</div>
              {meta && meta.label ? <div className="text-gray-600">Case: <span className="font-medium">{meta.label}</span></div> : null}
              <button onClick={openModal} className="ml-auto px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">
                View Analysis
              </button>
            </div>
            <div className="mt-3 grid grid-cols-2 md:grid-cols-4 gap-3">
              {DIMS.map(d=>(
                <div key={d.key} className="text-sm">
                  <span className="font-semibold">{d.label}:</span> {getLabel(scores[d.key] || 0)} ({scores[d.key] || 0})
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    // ===== App =====
    function App(){
      const [tab,setTab]=useState('test');
      const [scores,setScores]=useState({Cognitive:0,Irreversibility:0,Disruption:0,Generative:0});
      const [meta,setMeta]=useState({label:""});
      const [subScores,setSubScores]=useState({});
      const [issues,setIssues]=useState([]);
      const [modalOpen,setModalOpen]=useState(false);

      const openModal = ()=> setModalOpen(true);
      const closeModal = ()=> setModalOpen(false);

      return (
        <main>
          <header className="text-center space-y-1 mb-6">
            <h1 className="text-4xl md:text-5xl font-extrabold text-gray-900">
              Military Innovation Assessment Framework
            </h1>
            <h2 className="text-xl md:text-2xl font-bold text-gray-800">
              A Four-Dimensional Recognition Tool
            </h2>
            <div className="text-md md:text-lg text-gray-700">
              Based on "Military Innovation: Between the Knowns and the Unknowns"
            </div>
            <div className="text-xs text-gray-500 mt-1">(c) Manabrata Guha, 2025</div>
          </header>

          <div className="big-tabs">
            {[
              {k:'test',label:'Test Your Idea'},
              {k:'examples',label:'Historical Examples'}
            ].map(t=>(
              <button key={t.k} onClick={()=>setTab(t.k)}
                className={'big-tab ' + (tab===t.k?'big-tab-active':'big-tab-inactive')}>{t.label}</button>
            ))}
          </div>

          <div className="panel panel-b text-sm mb-6">
            <div className="font-semibold mb-2">Assessment Scale</div>
            <div className="grid grid-cols-5 gap-2 text-center">
              {LABELS.map((label, idx) => (
                <div key={idx} className="p-2 bg-gray-50 rounded">
                  <div className="font-medium">{label}</div>
                  <div className="text-xs text-gray-600">({idx})</div>
                </div>
              ))}
            </div>
            <div className="mt-3 text-xs text-gray-600">
              <strong>Methodological Note:</strong> Numerical values (0-4) are used for computational purposes only. Assessment is based on qualitative evidence levels.
            </div>
          </div>

          <section className="space-y-6">
            {tab==='test' && (
              <>
                <TestYourIdea
                  setScores={setScores}
                  setMeta={setMeta}
                  setSubScores={setSubScores}
                  setIssues={setIssues}
                />
                <ChartsPanel scores={scores} meta={meta} openModal={openModal}/>
              </>
            )}
            {tab==='examples' && (
              <>
                <HistoricalExamples
                  setScores={setScores}
                  setMeta={setMeta}
                  setSubScores={setSubScores}
                  setIssues={setIssues}
                />
                <ChartsPanel scores={scores} meta={meta} openModal={openModal}/>
              </>
            )}
          </section>

          <footer className="mt-10 text-center text-xs text-gray-500">
            Military Innovation Assessment Framework - Recognition tool for systematic analysis of military change patterns.
          </footer>

          {modalOpen && <IssuesModal issues={issues} meta={meta} subScores={subScores} dimScores={scores} onClose={closeModal}/>}
        </main>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
